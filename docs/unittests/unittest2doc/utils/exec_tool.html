

<!DOCTYPE html>

<html lang="en" data-content_root="../../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>unittest2doc.utils.exec_tool &#8212; unittest2doc  documentation</title>
    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../../../_static/cloud.css?v=f9ae72be" />
    <link rel="stylesheet" type="text/css" href="../../../_static/custom.css?v=2c7d14eb" />
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Noticia+Text:400,i,b,bi|Open+Sans:400,i,b,bi|Roboto+Mono:400,i,b,bi&amp;display=swap" type="text/css" />
    
    <script src="../../../_static/jquery.js?v=5d32c60e"></script>
    <script src="../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
    <script src="../../../_static/underscore.js?v=e1a751a7"></script>
    <script src="../../../_static/underscore_rename.js?v=cd124915"></script>
    <script src="../../../_static/documentation_options.js?v=5929fcd5"></script>
    <script src="../../../_static/doctools.js?v=9bcbadda"></script>
    <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../_static/jquery.js?v=5d32c60e"></script>
    <script src="../../../_static/underscore.js?v=e1a751a7"></script>

    
    
     
        <script src="../../../_static/jquery.cookie.js"></script>
    

    
     
        <script src="../../../_static/cloud.base.js"></script>
    

    
     
        <script src="../../../_static/cloud.js"></script>
    

    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="prev" title="unittest2doc.utils" href="index.html" /> 
        <meta name="viewport" content="width=device-width, initial-scale=1">
  </head><body>
    <div class="relbar-top">
        
    <div class="related" role="navigation" aria-label="Related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> &nbsp; &nbsp;</li>
        <li class="right" >
          <a href="index.html" title="unittest2doc.utils"
             accesskey="P">previous</a> &nbsp; &nbsp;</li>
    <li><a href="../../../index.html">unittest2doc  documentation</a> &#187;</li>

          <li class="nav-item nav-item-1"><a href="../../../catalogue.html" >API Documentation</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="../../index.html" >UNITTESTs</a> &#187;</li>
          <li class="nav-item nav-item-3"><a href="../index.html" >unittest2doc</a> &#187;</li>
          <li class="nav-item nav-item-4"><a href="index.html" accesskey="U">unittest2doc.utils</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">unittest2doc.utils.exec_tool</a></li> 
      </ul>
    </div>
    </div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="unittest2doc-utils-exec-tool">
<span id="unittests-unittest2doc-utils-exec-tool"></span><h1>unittest2doc.utils.exec_tool<a class="headerlink" href="#unittest2doc-utils-exec-tool" title="Link to this heading">¶</a></h1>
<p>references: <a class="reference internal" href="../../../src/unittest2doc.utils.exec_tool.html#module-unittest2doc.utils.exec_tool" title="unittest2doc.utils.exec_tool"><code class="xref py py-mod docutils literal notranslate"><span class="pre">unittest2doc.utils.exec_tool</span></code></a></p>
<section id="test-case-by-load-main">
<h2>Test case by load_main<a class="headerlink" href="#test-case-by-load-main" title="Link to this heading">¶</a></h2>
<p>In the AI era, large language models have dramatically improved our coding efficiency.
Our use of LLMs for coding has evolved through three stages:</p>
<ul class="simple">
<li><p><strong>Ask</strong>: Using web interfaces or APIs, we submit requirements or code snippets to LLMs and receive code output</p></li>
<li><p><strong>Compose</strong>: LLMs gain the ability to view and modify local code, but interaction remains in a question-and-answer format</p></li>
<li><p><strong>Agent</strong>: LLMs not only have the ability to view and modify local code, but also possess local shell privileges, enabling them to execute any shell commands</p></li>
</ul>
<p>Agent-based coding represents a qualitative transformation in programming.
Previously, we might have found LLMs occasionally unreliable or cumbersome to use because
we had to constantly review their output for correctness.
However, in Agent mode, specifically for program development scenarios,
we can guide LLMs to write unit tests and instruct them to repeatedly
execute these tests while modifying the program.
Unit tests can, to a significant extent, replace human oversight in iterative reviews,
dramatically improving the efficiency of AI code iteration.</p>
<p>In Agent mode, we can attempt to decouple code logic by decomposing it into many small modules.
Each module contains only functions and classes with specific functionality, structured as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># some module.py</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">something</span>

<span class="k">class</span><span class="w"> </span><span class="nc">SomeClass</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;detailed document&#39;&#39;&#39;</span>
    <span class="k">pass</span>

<span class="k">def</span><span class="w"> </span><span class="nf">someFunc</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;detailed document&#39;&#39;&#39;</span>
    <span class="k">pass</span>

<span class="n">SOME_CONSTANT</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="kn">import</span><span class="w"> </span><span class="nn">unittest</span>
    <span class="k">class</span><span class="w"> </span><span class="nc">TestCase</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
        <span class="k">pass</span>
    <span class="n">unittest</span><span class="o">.</span><span class="n">main</span><span class="p">()</span>
</pre></div>
</div>
<p>This structure encompasses complete program implementation, comprehensive documentation, and full unit testing.
Agents can focus on a single file, continuously testing, modifying,
and refining it until achieving high-quality, fully-tested code.</p>
<p>However, this structure presents a challenge:
we cannot use other methods like pytest to discover and run the TestCases contained within for batch testing.
Our example below will use some helper functions, employing Unittest2doc to load, run, and document the test cases
in the <code class="docutils literal notranslate"><span class="pre">if</span> <span class="pre">__name__</span> <span class="pre">==</span> <span class="pre">&quot;__main__&quot;</span></code> block.</p>
<p>In normal case, you really should follow other CI/CD guidelines to</p>
<ul class="simple">
<li><p>put code under <code class="docutils literal notranslate"><span class="pre">src/package/module/to/code.py</span></code> (the module part)</p></li>
<li><p>put test code under <code class="docutils literal notranslate"><span class="pre">tests/somewhere/to/test_code.py</span></code> (all the test cases and a possible one line <code class="docutils literal notranslate"><span class="pre">unittest.main()</span></code> code in the <code class="docutils literal notranslate"><span class="pre">if</span> <span class="pre">__name__</span> <span class="pre">==</span> <span class="pre">&quot;__main__&quot;</span></code> block)</p></li>
</ul>
<p>In this way, pytest can discover and run the test cases, this is the standard way to do unit testing.</p>
<p>But here we CAN run the test cases in the <code class="docutils literal notranslate"><span class="pre">if</span> <span class="pre">__name__</span> <span class="pre">==</span> <span class="pre">&quot;__main__&quot;</span></code> block, using the following code:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">unittest2doc</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">unittest2doc</span><span class="w"> </span><span class="kn">import</span> <span class="n">Unittest2Doc</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">unittest2doc.utils.exec_tool</span><span class="w"> </span><span class="kn">import</span> <span class="n">filter_after_comment_by</span><span class="p">,</span> <span class="n">load_module</span><span class="p">,</span> <span class="n">collect_module_attr</span><span class="p">,</span> <span class="n">load_main</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">test_module</span> <span class="o">=</span> <span class="s2">&quot;unittest2doc.utils.exec_tool&quot;</span>
    <span class="n">module</span> <span class="o">=</span> <span class="n">load_module</span><span class="p">(</span><span class="n">test_module</span><span class="p">)</span>
    <span class="n">module_globals</span> <span class="o">=</span> <span class="n">collect_module_attr</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="nb">all</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">main</span> <span class="o">=</span> <span class="n">load_main</span><span class="p">(</span>
             <span class="n">module</span><span class="p">,</span>
             <span class="n">code_filter</span><span class="o">=</span><span class="n">filter_after_comment_by</span><span class="p">(</span><span class="s2">&quot;Run unittests&quot;</span><span class="p">),</span>
             <span class="nb">globals</span><span class="o">=</span><span class="n">module_globals</span><span class="p">,</span>
             <span class="n">add_code_object</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
           <span class="p">)</span>

    <span class="n">t</span> <span class="o">=</span> <span class="n">unittest2doc</span><span class="o">.</span><span class="n">Unittest2Doc</span><span class="p">(</span>
        <span class="n">testcase</span><span class="o">=</span><span class="n">main</span><span class="p">[</span><span class="s1">&#39;TestExecTool&#39;</span><span class="p">](),</span>
        <span class="n">name</span><span class="o">=</span><span class="s1">&#39;unittest2doc.utils.exec_tool&#39;</span><span class="p">,</span>
        <span class="n">ref</span><span class="o">=</span><span class="s1">&#39;:mod:`unittest2doc.utils.exec_tool`&#39;</span><span class="p">,</span>
        <span class="n">doc_root</span><span class="o">=</span><span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">absolute</span><span class="p">()</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">parent</span> <span class="o">/</span> <span class="s1">&#39;sphinx-docs/source/unittests&#39;</span><span class="p">,</span>
        <span class="n">open_input</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">t</span><span class="o">.</span><span class="n">generate_docs</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="filter-after-comment-string-match">
<span id="unittests-unittest2doc-utils-exec-tool-filter-after-comment-string-match"></span><h2>filter_after_comment_string_match<a class="headerlink" href="#filter-after-comment-string-match" title="Link to this heading">¶</a></h2>
<p>Test filter_after_comment with string matching.</p>
<details class="summary-input">
<summary>INPUT</summary><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">test_filter_after_comment_string_match</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test filter_after_comment with string matching.&quot;&quot;&quot;</span>
    <span class="n">code</span> <span class="o">=</span> <span class="n">dedent</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">        def func1():</span>
<span class="s1">            return &quot;before&quot;</span>

<span class="s1">        def func2():</span>
<span class="s1">            return &quot;middle&quot;</span>

<span class="s1">        # REMOVE: everything after this comment</span>
<span class="s1">        def func3():</span>
<span class="s1">            return &quot;after&quot;</span>

<span class="s1">        class AfterClass:</span>
<span class="s1">            pass</span>
<span class="s1">    &#39;&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

    <span class="n">result</span> <span class="o">=</span> <span class="n">filter_after_comment</span><span class="p">(</span><span class="n">code</span><span class="p">,</span> <span class="s2">&quot;REMOVE: everything after this comment&quot;</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s1">&#39;def func1():&#39;</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s1">&#39;def func2():&#39;</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">assertNotIn</span><span class="p">(</span><span class="s1">&#39;def func3():&#39;</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">assertNotIn</span><span class="p">(</span><span class="s1">&#39;class AfterClass:&#39;</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">assertNotIn</span><span class="p">(</span><span class="s1">&#39;REMOVE:&#39;</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span>
</pre></div>
</div>
</details></section>
<section id="filter-after-comment-regex-match">
<span id="unittests-unittest2doc-utils-exec-tool-filter-after-comment-regex-match"></span><h2>filter_after_comment_regex_match<a class="headerlink" href="#filter-after-comment-regex-match" title="Link to this heading">¶</a></h2>
<p>Test filter_after_comment with regex pattern.</p>
<details class="summary-input">
<summary>INPUT</summary><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">test_filter_after_comment_regex_match</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test filter_after_comment with regex pattern.&quot;&quot;&quot;</span>
    <span class="n">code</span> <span class="o">=</span> <span class="n">dedent</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">        import os</span>
<span class="s1">        import sys</span>

<span class="s1">        def main():</span>
<span class="s1">            print(&quot;Hello&quot;)</span>

<span class="s1">        # TODO: implement feature xyz</span>
<span class="s1">        def unfinished_function():</span>
<span class="s1">            pass</span>

<span class="s1">        # NOTE: this is important</span>
<span class="s1">        def another_function():</span>
<span class="s1">            pass</span>
<span class="s1">    &#39;&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

    <span class="c1"># Use regex to match any TODO comment</span>
    <span class="n">pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;TODO:.*&#39;</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">filter_after_comment</span><span class="p">(</span><span class="n">code</span><span class="p">,</span> <span class="n">pattern</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s1">&#39;def main():&#39;</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">assertNotIn</span><span class="p">(</span><span class="s1">&#39;def unfinished_function():&#39;</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">assertNotIn</span><span class="p">(</span><span class="s1">&#39;def another_function():&#39;</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">assertNotIn</span><span class="p">(</span><span class="s1">&#39;TODO:&#39;</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span>
</pre></div>
</div>
</details></section>
<section id="filter-after-comment-no-match">
<span id="unittests-unittest2doc-utils-exec-tool-filter-after-comment-no-match"></span><h2>filter_after_comment_no_match<a class="headerlink" href="#filter-after-comment-no-match" title="Link to this heading">¶</a></h2>
<p>Test filter_after_comment when comment is not found.</p>
<details class="summary-input">
<summary>INPUT</summary><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">test_filter_after_comment_no_match</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test filter_after_comment when comment is not found.&quot;&quot;&quot;</span>
    <span class="n">code</span> <span class="o">=</span> <span class="n">dedent</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">        def func1():</span>
<span class="s1">            return &quot;test&quot;</span>

<span class="s1">        # Some other comment</span>
<span class="s1">        def func2():</span>
<span class="s1">            return &quot;test2&quot;</span>
<span class="s1">    &#39;&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

    <span class="n">result</span> <span class="o">=</span> <span class="n">filter_after_comment</span><span class="p">(</span><span class="n">code</span><span class="p">,</span> <span class="s2">&quot;NONEXISTENT COMMENT&quot;</span><span class="p">)</span>

    <span class="c1"># Should return original code unchanged</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">code</span><span class="p">)</span>
</pre></div>
</div>
</details></section>
<section id="filter-after-comment-multiple-matches">
<span id="unittests-unittest2doc-utils-exec-tool-filter-after-comment-multiple-matches"></span><h2>filter_after_comment_multiple_matches<a class="headerlink" href="#filter-after-comment-multiple-matches" title="Link to this heading">¶</a></h2>
<p>Test filter_after_comment with multiple matching comments.</p>
<details class="summary-input">
<summary>INPUT</summary><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">test_filter_after_comment_multiple_matches</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test filter_after_comment with multiple matching comments.&quot;&quot;&quot;</span>
    <span class="n">code</span> <span class="o">=</span> <span class="n">dedent</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">        def func1():</span>
<span class="s1">            return 1</span>

<span class="s1">        # STOP here first time</span>
<span class="s1">        def func2():</span>
<span class="s1">            return 2</span>

<span class="s1">        # STOP here second time</span>
<span class="s1">        def func3():</span>
<span class="s1">            return 3</span>
<span class="s1">    &#39;&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

    <span class="n">result</span> <span class="o">=</span> <span class="n">filter_after_comment</span><span class="p">(</span><span class="n">code</span><span class="p">,</span> <span class="s2">&quot;STOP&quot;</span><span class="p">)</span>

    <span class="c1"># Should stop at the first match</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s1">&#39;def func1():&#39;</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">assertNotIn</span><span class="p">(</span><span class="s1">&#39;def func2():&#39;</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">assertNotIn</span><span class="p">(</span><span class="s1">&#39;def func3():&#39;</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">assertNotIn</span><span class="p">(</span><span class="s1">&#39;STOP here first time&#39;</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span>
</pre></div>
</div>
</details></section>
<section id="filter-after-comment-empty-code">
<span id="unittests-unittest2doc-utils-exec-tool-filter-after-comment-empty-code"></span><h2>filter_after_comment_empty_code<a class="headerlink" href="#filter-after-comment-empty-code" title="Link to this heading">¶</a></h2>
<p>Test filter_after_comment with empty code.</p>
<details class="summary-input">
<summary>INPUT</summary><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">test_filter_after_comment_empty_code</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test filter_after_comment with empty code.&quot;&quot;&quot;</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">filter_after_comment</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;any comment&quot;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>

    <span class="n">result</span> <span class="o">=</span> <span class="n">filter_after_comment</span><span class="p">(</span><span class="s2">&quot;   &quot;</span><span class="p">,</span> <span class="s2">&quot;any comment&quot;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="s2">&quot;   &quot;</span><span class="p">)</span>
</pre></div>
</div>
</details></section>
<section id="filter-after-comment-comment-at-end">
<span id="unittests-unittest2doc-utils-exec-tool-filter-after-comment-comment-at-end"></span><h2>filter_after_comment_comment_at_end<a class="headerlink" href="#filter-after-comment-comment-at-end" title="Link to this heading">¶</a></h2>
<p>Test filter_after_comment when comment is at the last line.</p>
<details class="summary-input">
<summary>INPUT</summary><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">test_filter_after_comment_comment_at_end</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test filter_after_comment when comment is at the last line.&quot;&quot;&quot;</span>
    <span class="n">code</span> <span class="o">=</span> <span class="n">dedent</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">        def func():</span>
<span class="s1">            return &quot;test&quot;</span>

<span class="s1">        x = 1</span>
<span class="s1">        # END: this is the last line</span>
<span class="s1">    &#39;&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

    <span class="n">result</span> <span class="o">=</span> <span class="n">filter_after_comment</span><span class="p">(</span><span class="n">code</span><span class="p">,</span> <span class="s2">&quot;END: this is the last line&quot;</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s1">&#39;def func():&#39;</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s1">&#39;x = 1&#39;</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">assertNotIn</span><span class="p">(</span><span class="s1">&#39;END:&#39;</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span>
</pre></div>
</div>
</details></section>
<section id="filter-after-comment-regex-complex">
<span id="unittests-unittest2doc-utils-exec-tool-filter-after-comment-regex-complex"></span><h2>filter_after_comment_regex_complex<a class="headerlink" href="#filter-after-comment-regex-complex" title="Link to this heading">¶</a></h2>
<p>Test filter_after_comment with complex regex.</p>
<details class="summary-input">
<summary>INPUT</summary><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">test_filter_after_comment_regex_complex</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test filter_after_comment with complex regex.&quot;&quot;&quot;</span>
    <span class="n">code</span> <span class="o">=</span> <span class="n">dedent</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">        import math</span>

<span class="s1">        def calculate():</span>
<span class="s1">            return math.pi</span>

<span class="s1">        # Version: 1.2.3 - remove from here</span>
<span class="s1">        def version_specific():</span>
<span class="s1">            pass</span>

<span class="s1">        # Version: 2.0.0 - and this too</span>
<span class="s1">        def newer_version():</span>
<span class="s1">            pass</span>
<span class="s1">    &#39;&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

    <span class="c1"># Match any version comment</span>
    <span class="n">pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;Version:\s+\d+\.\d+\.\d+&#39;</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">filter_after_comment</span><span class="p">(</span><span class="n">code</span><span class="p">,</span> <span class="n">pattern</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s1">&#39;def calculate():&#39;</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">assertNotIn</span><span class="p">(</span><span class="s1">&#39;def version_specific():&#39;</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">assertNotIn</span><span class="p">(</span><span class="s1">&#39;def newer_version():&#39;</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">assertNotIn</span><span class="p">(</span><span class="s1">&#39;Version:&#39;</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span>
</pre></div>
</div>
</details></section>
<section id="filter-after-comment-invalid-pattern-type">
<span id="unittests-unittest2doc-utils-exec-tool-filter-after-comment-invalid-pattern-type"></span><h2>filter_after_comment_invalid_pattern_type<a class="headerlink" href="#filter-after-comment-invalid-pattern-type" title="Link to this heading">¶</a></h2>
<p>Test filter_after_comment with invalid pattern type.</p>
<details class="summary-input">
<summary>INPUT</summary><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">test_filter_after_comment_invalid_pattern_type</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test filter_after_comment with invalid pattern type.&quot;&quot;&quot;</span>
    <span class="n">code</span> <span class="o">=</span> <span class="n">dedent</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">        def func():</span>
<span class="s1">            return &quot;test&quot;</span>

<span class="s1">        # Some comment here</span>
<span class="s1">        def another_func():</span>
<span class="s1">            pass</span>
<span class="s1">    &#39;&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

    <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">):</span>
        <span class="n">filter_after_comment</span><span class="p">(</span><span class="n">code</span><span class="p">,</span> <span class="mi">123</span><span class="p">)</span>  <span class="c1"># Invalid type</span>
</pre></div>
</div>
</details></section>
<section id="load-module-with-module-name">
<span id="unittests-unittest2doc-utils-exec-tool-load-module-with-module-name"></span><h2>load_module_with_module_name<a class="headerlink" href="#load-module-with-module-name" title="Link to this heading">¶</a></h2>
<p>Test load_module with standard module name.</p>
<details class="summary-input">
<summary>INPUT</summary><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">test_load_module_with_module_name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test load_module with standard module name.&quot;&quot;&quot;</span>
    <span class="c1"># Test with built-in module</span>
    <span class="n">os_module</span> <span class="o">=</span> <span class="n">load_module</span><span class="p">(</span><span class="s2">&quot;os&quot;</span><span class="p">)</span>
    <span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">os_module</span><span class="p">,</span> <span class="n">os</span><span class="p">)</span>

    <span class="c1"># Test with sub-module</span>
    <span class="n">path_module</span> <span class="o">=</span> <span class="n">load_module</span><span class="p">(</span><span class="s2">&quot;os.path&quot;</span><span class="p">)</span>
    <span class="kn">import</span><span class="w"> </span><span class="nn">os.path</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">path_module</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
</pre></div>
</div>
</details></section>
<section id="load-module-with-file-path">
<span id="unittests-unittest2doc-utils-exec-tool-load-module-with-file-path"></span><h2>load_module_with_file_path<a class="headerlink" href="#load-module-with-file-path" title="Link to this heading">¶</a></h2>
<p>Test load_module with file path.</p>
<details class="summary-input">
<summary>INPUT</summary><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">test_load_module_with_file_path</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test load_module with file path.&quot;&quot;&quot;</span>
    <span class="n">test_content</span> <span class="o">=</span> <span class="n">dedent</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">        def test_function():</span>
<span class="s1">            return &quot;from file path&quot;</span>

<span class="s1">        TEST_CONSTANT = 42</span>
<span class="s1">    &#39;&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

    <span class="k">with</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">NamedTemporaryFile</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">suffix</span><span class="o">=</span><span class="s1">&#39;.py&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">test_content</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>

        <span class="n">resolved_module</span> <span class="o">=</span> <span class="n">load_module</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="nb">hasattr</span><span class="p">(</span><span class="n">resolved_module</span><span class="p">,</span> <span class="s1">&#39;test_function&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="nb">hasattr</span><span class="p">(</span><span class="n">resolved_module</span><span class="p">,</span> <span class="s1">&#39;TEST_CONSTANT&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">resolved_module</span><span class="o">.</span><span class="n">test_function</span><span class="p">(),</span> <span class="s2">&quot;from file path&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">resolved_module</span><span class="o">.</span><span class="n">TEST_CONSTANT</span><span class="p">,</span> <span class="mi">42</span><span class="p">)</span>
</pre></div>
</div>
</details></section>
<section id="load-module-with-module-object">
<span id="unittests-unittest2doc-utils-exec-tool-load-module-with-module-object"></span><h2>load_module_with_module_object<a class="headerlink" href="#load-module-with-module-object" title="Link to this heading">¶</a></h2>
<p>Test load_module with existing module object.</p>
<details class="summary-input">
<summary>INPUT</summary><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">test_load_module_with_module_object</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test load_module with existing module object.&quot;&quot;&quot;</span>
    <span class="kn">import</span><span class="w"> </span><span class="nn">math</span>
    <span class="n">resolved_module</span> <span class="o">=</span> <span class="n">load_module</span><span class="p">(</span><span class="n">math</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">resolved_module</span><span class="p">,</span> <span class="n">math</span><span class="p">)</span>
</pre></div>
</div>
</details></section>
<section id="load-module-errors">
<span id="unittests-unittest2doc-utils-exec-tool-load-module-errors"></span><h2>load_module_errors<a class="headerlink" href="#load-module-errors" title="Link to this heading">¶</a></h2>
<p>Test load_module error cases.</p>
<details class="summary-input">
<summary>INPUT</summary><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">test_load_module_errors</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test load_module error cases.&quot;&quot;&quot;</span>
    <span class="c1"># Non-existent module</span>
    <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">ImportError</span><span class="p">):</span>
        <span class="n">load_module</span><span class="p">(</span><span class="s2">&quot;non_existent_module_12345&quot;</span><span class="p">)</span>

    <span class="c1"># Non-existent file path</span>
    <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">FileNotFoundError</span><span class="p">):</span>
        <span class="n">load_module</span><span class="p">(</span><span class="s2">&quot;/non/existent/path.py&quot;</span><span class="p">)</span>

    <span class="c1"># Invalid type</span>
    <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">):</span>
        <span class="n">load_module</span><span class="p">(</span><span class="mi">123</span><span class="p">)</span>
</pre></div>
</div>
</details></section>
<section id="collect-module-attr-all">
<span id="unittests-unittest2doc-utils-exec-tool-collect-module-attr-all"></span><h2>collect_module_attr_all<a class="headerlink" href="#collect-module-attr-all" title="Link to this heading">¶</a></h2>
<p>Test collect_module_attr with all=True.</p>
<details class="summary-input">
<summary>INPUT</summary><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">test_collect_module_attr_all</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test collect_module_attr with all=True.&quot;&quot;&quot;</span>
    <span class="n">test_content</span> <span class="o">=</span> <span class="n">dedent</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">        def test_func():</span>
<span class="s1">            return &quot;test&quot;</span>

<span class="s1">        TEST_VAR = 42</span>
<span class="s1">        TEST_STR = &quot;hello&quot;</span>
<span class="s1">    &#39;&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

    <span class="k">with</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">NamedTemporaryFile</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">suffix</span><span class="o">=</span><span class="s1">&#39;.py&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">test_content</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>

        <span class="n">attrs</span> <span class="o">=</span> <span class="n">collect_module_attr</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="nb">all</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Should contain all module attributes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s1">&#39;test_func&#39;</span><span class="p">,</span> <span class="n">attrs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s1">&#39;TEST_VAR&#39;</span><span class="p">,</span> <span class="n">attrs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s1">&#39;TEST_STR&#39;</span><span class="p">,</span> <span class="n">attrs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;TEST_VAR&#39;</span><span class="p">],</span> <span class="mi">42</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;test_func&#39;</span><span class="p">](),</span> <span class="s1">&#39;test&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;TEST_STR&#39;</span><span class="p">],</span> <span class="s2">&quot;hello&quot;</span><span class="p">)</span>
</pre></div>
</div>
</details></section>
<section id="collect-module-attr-names-dict">
<span id="unittests-unittest2doc-utils-exec-tool-collect-module-attr-names-dict"></span><h2>collect_module_attr_names_dict<a class="headerlink" href="#collect-module-attr-names-dict" title="Link to this heading">¶</a></h2>
<p>Test collect_module_attr with names as dict (source-&gt;target mapping).</p>
<details class="summary-input">
<summary>INPUT</summary><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">test_collect_module_attr_names_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test collect_module_attr with names as dict (source-&gt;target mapping).&quot;&quot;&quot;</span>
    <span class="kn">import</span><span class="w"> </span><span class="nn">math</span>

    <span class="c1"># Test direct name mapping: source_name -&gt; target_name</span>
    <span class="n">attrs</span> <span class="o">=</span> <span class="n">collect_module_attr</span><span class="p">(</span><span class="n">math</span><span class="p">,</span> <span class="n">names</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;pi&#39;</span><span class="p">:</span> <span class="s1">&#39;PI&#39;</span><span class="p">,</span> <span class="s1">&#39;sqrt&#39;</span><span class="p">:</span> <span class="s1">&#39;SQRT&#39;</span><span class="p">})</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s1">&#39;PI&#39;</span><span class="p">,</span> <span class="n">attrs</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s1">&#39;SQRT&#39;</span><span class="p">,</span> <span class="n">attrs</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;PI&#39;</span><span class="p">],</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;SQRT&#39;</span><span class="p">],</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">)</span>
    <span class="c1"># Original names should not be present</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">assertNotIn</span><span class="p">(</span><span class="s1">&#39;pi&#39;</span><span class="p">,</span> <span class="n">attrs</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">assertNotIn</span><span class="p">(</span><span class="s1">&#39;sqrt&#39;</span><span class="p">,</span> <span class="n">attrs</span><span class="p">)</span>
</pre></div>
</div>
</details></section>
<section id="collect-module-attr-names-list">
<span id="unittests-unittest2doc-utils-exec-tool-collect-module-attr-names-list"></span><h2>collect_module_attr_names_list<a class="headerlink" href="#collect-module-attr-names-list" title="Link to this heading">¶</a></h2>
<p>Test collect_module_attr with names as list (original names).</p>
<details class="summary-input">
<summary>INPUT</summary><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">test_collect_module_attr_names_list</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test collect_module_attr with names as list (original names).&quot;&quot;&quot;</span>
    <span class="kn">import</span><span class="w"> </span><span class="nn">math</span>

    <span class="c1"># Test list format uses original names</span>
    <span class="n">attrs</span> <span class="o">=</span> <span class="n">collect_module_attr</span><span class="p">(</span><span class="n">math</span><span class="p">,</span> <span class="n">names</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;pi&#39;</span><span class="p">,</span> <span class="s1">&#39;sqrt&#39;</span><span class="p">])</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s1">&#39;pi&#39;</span><span class="p">,</span> <span class="n">attrs</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s1">&#39;sqrt&#39;</span><span class="p">,</span> <span class="n">attrs</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;pi&#39;</span><span class="p">],</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;sqrt&#39;</span><span class="p">],</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">)</span>
</pre></div>
</div>
</details></section>
<section id="collect-module-attr-names-regex-dict">
<span id="unittests-unittest2doc-utils-exec-tool-collect-module-attr-names-regex-dict"></span><h2>collect_module_attr_names_regex_dict<a class="headerlink" href="#collect-module-attr-names-regex-dict" title="Link to this heading">¶</a></h2>
<p>Test collect_module_attr with regex patterns in dict.</p>
<details class="summary-input">
<summary>INPUT</summary><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">test_collect_module_attr_names_regex_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test collect_module_attr with regex patterns in dict.&quot;&quot;&quot;</span>
    <span class="kn">import</span><span class="w"> </span><span class="nn">math</span>

    <span class="c1"># Test regex pattern in dict - should use original names (value is ignored)</span>
    <span class="n">attrs</span> <span class="o">=</span> <span class="n">collect_module_attr</span><span class="p">(</span>
        <span class="n">math</span><span class="p">,</span>
        <span class="n">names</span><span class="o">=</span><span class="p">{</span><span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^(sin|cos|tan)$&#39;</span><span class="p">):</span> <span class="s1">&#39;ignored_value&#39;</span><span class="p">}</span>
    <span class="p">)</span>

    <span class="c1"># With regex in dict, matched attributes use original names</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s1">&#39;sin&#39;</span><span class="p">,</span> <span class="n">attrs</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s1">&#39;cos&#39;</span><span class="p">,</span> <span class="n">attrs</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s1">&#39;tan&#39;</span><span class="p">,</span> <span class="n">attrs</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;sin&#39;</span><span class="p">],</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;cos&#39;</span><span class="p">],</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;tan&#39;</span><span class="p">],</span> <span class="n">math</span><span class="o">.</span><span class="n">tan</span><span class="p">)</span>
</pre></div>
</div>
</details></section>
<section id="collect-module-attr-names-regex-list">
<span id="unittests-unittest2doc-utils-exec-tool-collect-module-attr-names-regex-list"></span><h2>collect_module_attr_names_regex_list<a class="headerlink" href="#collect-module-attr-names-regex-list" title="Link to this heading">¶</a></h2>
<p>Test collect_module_attr with regex patterns in list.</p>
<details class="summary-input">
<summary>INPUT</summary><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">test_collect_module_attr_names_regex_list</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test collect_module_attr with regex patterns in list.&quot;&quot;&quot;</span>
    <span class="kn">import</span><span class="w"> </span><span class="nn">math</span>

    <span class="c1"># Test regex pattern in list - should use original names</span>
    <span class="n">attrs</span> <span class="o">=</span> <span class="n">collect_module_attr</span><span class="p">(</span>
        <span class="n">math</span><span class="p">,</span>
        <span class="n">names</span><span class="o">=</span><span class="p">[</span><span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^(sin|cos|tan)$&#39;</span><span class="p">)]</span>
    <span class="p">)</span>

    <span class="c1"># With regex in list, matched attributes use original names</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s1">&#39;sin&#39;</span><span class="p">,</span> <span class="n">attrs</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s1">&#39;cos&#39;</span><span class="p">,</span> <span class="n">attrs</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s1">&#39;tan&#39;</span><span class="p">,</span> <span class="n">attrs</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;sin&#39;</span><span class="p">],</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;cos&#39;</span><span class="p">],</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;tan&#39;</span><span class="p">],</span> <span class="n">math</span><span class="o">.</span><span class="n">tan</span><span class="p">)</span>
</pre></div>
</div>
</details></section>
<section id="collect-module-attr-names-mapping-dict">
<span id="unittests-unittest2doc-utils-exec-tool-collect-module-attr-names-mapping-dict"></span><h2>collect_module_attr_names_mapping_dict<a class="headerlink" href="#collect-module-attr-names-mapping-dict" title="Link to this heading">¶</a></h2>
<p>Test collect_module_attr with names_mapping as dict.</p>
<details class="summary-input">
<summary>INPUT</summary><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">test_collect_module_attr_names_mapping_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test collect_module_attr with names_mapping as dict.&quot;&quot;&quot;</span>
    <span class="kn">import</span><span class="w"> </span><span class="nn">math</span>

    <span class="c1"># First collect, then remap</span>
    <span class="n">attrs</span> <span class="o">=</span> <span class="n">collect_module_attr</span><span class="p">(</span>
        <span class="n">math</span><span class="p">,</span>
        <span class="n">names</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;pi&#39;</span><span class="p">,</span> <span class="s1">&#39;sqrt&#39;</span><span class="p">],</span>
        <span class="n">names_mapping</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;pi&#39;</span><span class="p">:</span> <span class="s1">&#39;PI_VALUE&#39;</span><span class="p">,</span> <span class="s1">&#39;sqrt&#39;</span><span class="p">:</span> <span class="s1">&#39;SQRT_FUNC&#39;</span><span class="p">}</span>
    <span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s1">&#39;PI_VALUE&#39;</span><span class="p">,</span> <span class="n">attrs</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s1">&#39;SQRT_FUNC&#39;</span><span class="p">,</span> <span class="n">attrs</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;PI_VALUE&#39;</span><span class="p">],</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;SQRT_FUNC&#39;</span><span class="p">],</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">)</span>
    <span class="c1"># Original names should be removed after mapping</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">assertNotIn</span><span class="p">(</span><span class="s1">&#39;pi&#39;</span><span class="p">,</span> <span class="n">attrs</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">assertNotIn</span><span class="p">(</span><span class="s1">&#39;sqrt&#39;</span><span class="p">,</span> <span class="n">attrs</span><span class="p">)</span>
</pre></div>
</div>
</details></section>
<section id="collect-module-attr-names-mapping-callable">
<span id="unittests-unittest2doc-utils-exec-tool-collect-module-attr-names-mapping-callable"></span><h2>collect_module_attr_names_mapping_callable<a class="headerlink" href="#collect-module-attr-names-mapping-callable" title="Link to this heading">¶</a></h2>
<p>Test collect_module_attr with names_mapping as callable.</p>
<details class="summary-input">
<summary>INPUT</summary><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">test_collect_module_attr_names_mapping_callable</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test collect_module_attr with names_mapping as callable.&quot;&quot;&quot;</span>
    <span class="kn">import</span><span class="w"> </span><span class="nn">math</span>

    <span class="c1"># Define a mapping function</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">to_upper_mapping</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">name</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>

    <span class="n">attrs</span> <span class="o">=</span> <span class="n">collect_module_attr</span><span class="p">(</span>
        <span class="n">math</span><span class="p">,</span>
        <span class="n">names</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;pi&#39;</span><span class="p">,</span> <span class="s1">&#39;sqrt&#39;</span><span class="p">],</span>
        <span class="n">names_mapping</span><span class="o">=</span><span class="n">to_upper_mapping</span>
    <span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s1">&#39;PI&#39;</span><span class="p">,</span> <span class="n">attrs</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s1">&#39;SQRT&#39;</span><span class="p">,</span> <span class="n">attrs</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;PI&#39;</span><span class="p">],</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;SQRT&#39;</span><span class="p">],</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">)</span>
</pre></div>
</div>
</details></section>
<section id="collect-module-attr-by-classes">
<span id="unittests-unittest2doc-utils-exec-tool-collect-module-attr-by-classes"></span><h2>collect_module_attr_by_classes<a class="headerlink" href="#collect-module-attr-by-classes" title="Link to this heading">¶</a></h2>
<p>Test collect_module_attr with class filtering.</p>
<details class="summary-input">
<summary>INPUT</summary><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">test_collect_module_attr_by_classes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test collect_module_attr with class filtering.&quot;&quot;&quot;</span>
    <span class="n">test_content</span> <span class="o">=</span> <span class="n">dedent</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">        test_int = 42</span>
<span class="s1">        test_str = &quot;hello&quot;</span>
<span class="s1">        test_float = 3.14</span>
<span class="s1">        test_list = [1, 2, 3]</span>

<span class="s1">        class TestClass:</span>
<span class="s1">            pass</span>

<span class="s1">        def test_func():</span>
<span class="s1">            pass</span>
<span class="s1">    &#39;&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

    <span class="k">with</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">NamedTemporaryFile</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">suffix</span><span class="o">=</span><span class="s1">&#39;.py&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">test_content</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>

        <span class="n">attrs</span> <span class="o">=</span> <span class="n">collect_module_attr</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">classes</span><span class="o">=</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s1">&#39;test_int&#39;</span><span class="p">,</span> <span class="n">attrs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s1">&#39;test_str&#39;</span><span class="p">,</span> <span class="n">attrs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertNotIn</span><span class="p">(</span><span class="s1">&#39;test_float&#39;</span><span class="p">,</span> <span class="n">attrs</span><span class="p">)</span>  <span class="c1"># float not in classes list</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertNotIn</span><span class="p">(</span><span class="s1">&#39;test_list&#39;</span><span class="p">,</span> <span class="n">attrs</span><span class="p">)</span>   <span class="c1"># list not in classes list</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;test_int&#39;</span><span class="p">],</span> <span class="mi">42</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;test_str&#39;</span><span class="p">],</span> <span class="s2">&quot;hello&quot;</span><span class="p">)</span>
</pre></div>
</div>
</details></section>
<section id="collect-module-attr-all-classes">
<span id="unittests-unittest2doc-utils-exec-tool-collect-module-attr-all-classes"></span><h2>collect_module_attr_all_classes<a class="headerlink" href="#collect-module-attr-all-classes" title="Link to this heading">¶</a></h2>
<p>Test collect_module_attr with classes=True to collect all classes.</p>
<details class="summary-input">
<summary>INPUT</summary><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">test_collect_module_attr_all_classes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test collect_module_attr with classes=True to collect all classes.&quot;&quot;&quot;</span>
    <span class="n">test_content</span> <span class="o">=</span> <span class="n">dedent</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">        class FirstClass:</span>
<span class="s1">            def method1(self):</span>
<span class="s1">                return &quot;first&quot;</span>

<span class="s1">        class SecondClass:</span>
<span class="s1">            def method2(self):</span>
<span class="s1">                return &quot;second&quot;</span>

<span class="s1">        class _PrivateClass:  # Should be skipped</span>
<span class="s1">            pass</span>

<span class="s1">        # These should not be collected</span>
<span class="s1">        test_int = 42</span>
<span class="s1">        test_str = &quot;hello&quot;</span>

<span class="s1">        def test_func():</span>
<span class="s1">            pass</span>
<span class="s1">    &#39;&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

    <span class="k">with</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">NamedTemporaryFile</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">suffix</span><span class="o">=</span><span class="s1">&#39;.py&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">test_content</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>

        <span class="n">attrs</span> <span class="o">=</span> <span class="n">collect_module_attr</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">classes</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Should contain all public classes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s1">&#39;FirstClass&#39;</span><span class="p">,</span> <span class="n">attrs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s1">&#39;SecondClass&#39;</span><span class="p">,</span> <span class="n">attrs</span><span class="p">)</span>

        <span class="c1"># Should not contain private class (starts with _)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertNotIn</span><span class="p">(</span><span class="s1">&#39;_PrivateClass&#39;</span><span class="p">,</span> <span class="n">attrs</span><span class="p">)</span>

        <span class="c1"># Should not contain non-class attributes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertNotIn</span><span class="p">(</span><span class="s1">&#39;test_int&#39;</span><span class="p">,</span> <span class="n">attrs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertNotIn</span><span class="p">(</span><span class="s1">&#39;test_str&#39;</span><span class="p">,</span> <span class="n">attrs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertNotIn</span><span class="p">(</span><span class="s1">&#39;test_func&#39;</span><span class="p">,</span> <span class="n">attrs</span><span class="p">)</span>

        <span class="c1"># Verify they are actually classes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">isclass</span><span class="p">(</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;FirstClass&#39;</span><span class="p">]))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">isclass</span><span class="p">(</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;SecondClass&#39;</span><span class="p">]))</span>

        <span class="c1"># Test instantiation</span>
        <span class="n">first_instance</span> <span class="o">=</span> <span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;FirstClass&#39;</span><span class="p">]()</span>
        <span class="n">second_instance</span> <span class="o">=</span> <span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;SecondClass&#39;</span><span class="p">]()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">first_instance</span><span class="o">.</span><span class="n">method1</span><span class="p">(),</span> <span class="s2">&quot;first&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">second_instance</span><span class="o">.</span><span class="n">method2</span><span class="p">(),</span> <span class="s2">&quot;second&quot;</span><span class="p">)</span>
</pre></div>
</div>
</details></section>
<section id="collect-module-attr-functions">
<span id="unittests-unittest2doc-utils-exec-tool-collect-module-attr-functions"></span><h2>collect_module_attr_functions<a class="headerlink" href="#collect-module-attr-functions" title="Link to this heading">¶</a></h2>
<p>Test collect_module_attr with function collection.</p>
<details class="summary-input">
<summary>INPUT</summary><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">test_collect_module_attr_functions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test collect_module_attr with function collection.&quot;&quot;&quot;</span>
    <span class="n">test_content</span> <span class="o">=</span> <span class="n">dedent</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">        def function_one():</span>
<span class="s1">            return 1</span>

<span class="s1">        def function_two():</span>
<span class="s1">            return 2</span>

<span class="s1">        class NotAFunction:</span>
<span class="s1">            pass</span>

<span class="s1">        variable = &quot;not a function&quot;</span>
<span class="s1">    &#39;&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

    <span class="k">with</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">NamedTemporaryFile</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">suffix</span><span class="o">=</span><span class="s1">&#39;.py&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">test_content</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>

        <span class="n">attrs</span> <span class="o">=</span> <span class="n">collect_module_attr</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">functions</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s1">&#39;function_one&#39;</span><span class="p">,</span> <span class="n">attrs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s1">&#39;function_two&#39;</span><span class="p">,</span> <span class="n">attrs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertNotIn</span><span class="p">(</span><span class="s1">&#39;NotAFunction&#39;</span><span class="p">,</span> <span class="n">attrs</span><span class="p">)</span>  <span class="c1"># Class, not function</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertNotIn</span><span class="p">(</span><span class="s1">&#39;variable&#39;</span><span class="p">,</span> <span class="n">attrs</span><span class="p">)</span>      <span class="c1"># Variable, not function</span>

        <span class="c1"># Test that functions are callable</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;function_one&#39;</span><span class="p">](),</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;function_two&#39;</span><span class="p">](),</span> <span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</details></section>
<section id="collect-module-attr-combined">
<span id="unittests-unittest2doc-utils-exec-tool-collect-module-attr-combined"></span><h2>collect_module_attr_combined<a class="headerlink" href="#collect-module-attr-combined" title="Link to this heading">¶</a></h2>
<p>Test collect_module_attr with multiple criteria and mapping.</p>
<details class="summary-input">
<summary>INPUT</summary><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">test_collect_module_attr_combined</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test collect_module_attr with multiple criteria and mapping.&quot;&quot;&quot;</span>
    <span class="n">test_content</span> <span class="o">=</span> <span class="n">dedent</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">        def helper_func():</span>
<span class="s1">            return &quot;helper&quot;</span>

<span class="s1">        def main_func():</span>
<span class="s1">            return &quot;main&quot;</span>

<span class="s1">        CONSTANT = 100</span>
<span class="s1">        message = &quot;hello world&quot;</span>

<span class="s1">        class MyClass:</span>
<span class="s1">            pass</span>
<span class="s1">    &#39;&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

    <span class="k">with</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">NamedTemporaryFile</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">suffix</span><span class="o">=</span><span class="s1">&#39;.py&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">test_content</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>

        <span class="n">attrs</span> <span class="o">=</span> <span class="n">collect_module_attr</span><span class="p">(</span>
            <span class="n">f</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
            <span class="n">names</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;message&#39;</span><span class="p">:</span> <span class="s1">&#39;MSG&#39;</span><span class="p">,</span> <span class="s1">&#39;CONSTANT&#39;</span><span class="p">:</span> <span class="s1">&#39;CONST&#39;</span><span class="p">},</span>  <span class="c1"># source-&gt;target mapping</span>
            <span class="n">classes</span><span class="o">=</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span>
            <span class="n">functions</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">names_mapping</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;helper_func&#39;</span><span class="p">:</span> <span class="s1">&#39;HELPER&#39;</span><span class="p">,</span> <span class="s1">&#39;main_func&#39;</span><span class="p">:</span> <span class="s1">&#39;MAIN&#39;</span><span class="p">}</span>
        <span class="p">)</span>

        <span class="c1"># Check remapped names from names dict</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s1">&#39;MSG&#39;</span><span class="p">,</span> <span class="n">attrs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s1">&#39;CONST&#39;</span><span class="p">,</span> <span class="n">attrs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;MSG&#39;</span><span class="p">],</span> <span class="s2">&quot;hello world&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;CONST&#39;</span><span class="p">],</span> <span class="mi">100</span><span class="p">)</span>

        <span class="c1"># Check classes (should also include the ones from names)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">attrs</span><span class="p">)</span>  <span class="c1"># str instance from classes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s1">&#39;CONSTANT&#39;</span><span class="p">,</span> <span class="n">attrs</span><span class="p">)</span>  <span class="c1"># int instance from classes</span>

        <span class="c1"># Check functions with mapping</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s1">&#39;HELPER&#39;</span><span class="p">,</span> <span class="n">attrs</span><span class="p">)</span>  <span class="c1"># mapped from helper_func</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s1">&#39;MAIN&#39;</span><span class="p">,</span> <span class="n">attrs</span><span class="p">)</span>    <span class="c1"># mapped from main_func</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertNotIn</span><span class="p">(</span><span class="s1">&#39;helper_func&#39;</span><span class="p">,</span> <span class="n">attrs</span><span class="p">)</span>  <span class="c1"># original should be removed</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertNotIn</span><span class="p">(</span><span class="s1">&#39;main_func&#39;</span><span class="p">,</span> <span class="n">attrs</span><span class="p">)</span>    <span class="c1"># original should be removed</span>

        <span class="c1"># Check that class is not included</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertNotIn</span><span class="p">(</span><span class="s1">&#39;MyClass&#39;</span><span class="p">,</span> <span class="n">attrs</span><span class="p">)</span>
</pre></div>
</div>
</details></section>
<section id="collect-module-attr-errors">
<span id="unittests-unittest2doc-utils-exec-tool-collect-module-attr-errors"></span><h2>collect_module_attr_errors<a class="headerlink" href="#collect-module-attr-errors" title="Link to this heading">¶</a></h2>
<p>Test collect_module_attr error cases.</p>
<details class="summary-input">
<summary>INPUT</summary><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">test_collect_module_attr_errors</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test collect_module_attr error cases.&quot;&quot;&quot;</span>
    <span class="kn">import</span><span class="w"> </span><span class="nn">math</span>

    <span class="c1"># Invalid names type</span>
    <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">):</span>
        <span class="n">collect_module_attr</span><span class="p">(</span><span class="n">math</span><span class="p">,</span> <span class="n">names</span><span class="o">=</span><span class="s2">&quot;invalid_string&quot;</span><span class="p">)</span>

    <span class="c1"># Invalid pattern type in dict (key should be str or re.Pattern)</span>
    <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">):</span>
        <span class="n">collect_module_attr</span><span class="p">(</span><span class="n">math</span><span class="p">,</span> <span class="n">names</span><span class="o">=</span><span class="p">{</span><span class="mi">123</span><span class="p">:</span> <span class="s1">&#39;target_name&#39;</span><span class="p">})</span>

    <span class="c1"># Invalid pattern type in list</span>
    <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">):</span>
        <span class="n">collect_module_attr</span><span class="p">(</span><span class="n">math</span><span class="p">,</span> <span class="n">names</span><span class="o">=</span><span class="p">[</span><span class="mi">123</span><span class="p">])</span>
</pre></div>
</div>
</details></section>
<section id="load-main-basic">
<span id="unittests-unittest2doc-utils-exec-tool-load-main-basic"></span><h2>load_main_basic<a class="headerlink" href="#load-main-basic" title="Link to this heading">¶</a></h2>
<p>Test basic load_main functionality using helper functions.</p>
<details class="summary-input">
<summary>INPUT</summary><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">test_load_main_basic</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test basic load_main functionality using helper functions.&quot;&quot;&quot;</span>
    <span class="n">test_content</span> <span class="o">=</span> <span class="n">dedent</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">        def greet(name):</span>
<span class="s1">            return f&quot;Hello, </span><span class="si">{name}</span><span class="s1">!&quot;</span>

<span class="s1">        value = 100</span>

<span class="s1">        if __name__ == &quot;__main__&quot;:</span>
<span class="s1">            message = greet(&quot;World&quot;)</span>
<span class="s1">            doubled = value * 2</span>
<span class="s1">            test_result = &quot;success&quot;</span>
<span class="s1">    &#39;&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

    <span class="k">with</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">NamedTemporaryFile</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">suffix</span><span class="o">=</span><span class="s1">&#39;.py&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">test_content</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>

        <span class="c1"># Use helper functions</span>
        <span class="n">module</span> <span class="o">=</span> <span class="n">load_module</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">test_globals</span> <span class="o">=</span> <span class="n">collect_module_attr</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="nb">all</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="n">result</span> <span class="o">=</span> <span class="n">load_main</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="nb">globals</span><span class="o">=</span><span class="n">test_globals</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s1">&#39;doubled&#39;</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s1">&#39;test_result&#39;</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;message&#39;</span><span class="p">],</span> <span class="s1">&#39;Hello, World!&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;doubled&#39;</span><span class="p">],</span> <span class="mi">200</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;test_result&#39;</span><span class="p">],</span> <span class="s1">&#39;success&#39;</span><span class="p">)</span>
</pre></div>
</div>
</details></section>
<section id="load-main-with-import">
<span id="unittests-unittest2doc-utils-exec-tool-load-main-with-import"></span><h2>load_main_with_import<a class="headerlink" href="#load-main-with-import" title="Link to this heading">¶</a></h2>
<p>Test basic load_main functionality using helper functions.</p>
<details class="summary-input">
<summary>INPUT</summary><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">test_load_main_with_import</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test basic load_main functionality using helper functions.&quot;&quot;&quot;</span>
    <span class="n">test_content</span> <span class="o">=</span> <span class="n">dedent</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">        if __name__ == &quot;__main__&quot;:</span>
<span class="s1">            import numpy as np</span>
<span class="s1">            from textwrap import dedent</span>
<span class="s1">            def test_func():</span>
<span class="s1">                return np.array([1, 2, 3])</span>

<span class="s1">    &#39;&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

    <span class="k">with</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">NamedTemporaryFile</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">suffix</span><span class="o">=</span><span class="s1">&#39;.py&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">test_content</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>

        <span class="c1"># Use helper functions</span>
        <span class="n">module</span> <span class="o">=</span> <span class="n">load_module</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">test_globals</span> <span class="o">=</span> <span class="n">collect_module_attr</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="nb">all</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="n">result</span> <span class="o">=</span> <span class="n">load_main</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="nb">globals</span><span class="o">=</span><span class="n">test_globals</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s1">&#39;np&#39;</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s1">&#39;dedent&#39;</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s1">&#39;test_func&#39;</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span>
        <span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
        <span class="c1"># Use numpy array comparison instead of assertEqual to avoid ambiguous truth value</span>
        <span class="n">np</span><span class="o">.</span><span class="n">testing</span><span class="o">.</span><span class="n">assert_array_equal</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;test_func&#39;</span><span class="p">](),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]))</span>
</pre></div>
</div>
</details></section>
<section id="load-main-with-classes">
<span id="unittests-unittest2doc-utils-exec-tool-load-main-with-classes"></span><h2>load_main_with_classes<a class="headerlink" href="#load-main-with-classes" title="Link to this heading">¶</a></h2>
<p>Test load_main with class definitions using helper functions.</p>
<details class="summary-input">
<summary>INPUT</summary><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">test_load_main_with_classes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test load_main with class definitions using helper functions.&quot;&quot;&quot;</span>
    <span class="n">test_content</span> <span class="o">=</span> <span class="n">dedent</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">        class Calculator:</span>
<span class="s1">            def __init__(self, name):</span>
<span class="s1">                self.name = name</span>

<span class="s1">            def add(self, a, b):</span>
<span class="s1">                return a + b</span>

<span class="s1">        DEFAULT_NAME = &quot;MyCalc&quot;</span>

<span class="s1">        if __name__ == &quot;__main__&quot;:</span>
<span class="s1">            calc = Calculator(DEFAULT_NAME)</span>
<span class="s1">            result = calc.add(10, 20)</span>
<span class="s1">            calc_name = calc.name + &quot;_used&quot;</span>
<span class="s1">    &#39;&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

    <span class="k">with</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">NamedTemporaryFile</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">suffix</span><span class="o">=</span><span class="s1">&#39;.py&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">test_content</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>

        <span class="c1"># Use helper functions</span>
        <span class="n">module</span> <span class="o">=</span> <span class="n">load_module</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">test_globals</span> <span class="o">=</span> <span class="n">collect_module_attr</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="nb">all</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="n">result</span> <span class="o">=</span> <span class="n">load_main</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="nb">globals</span><span class="o">=</span><span class="n">test_globals</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s1">&#39;calc&#39;</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s1">&#39;result&#39;</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s1">&#39;calc_name&#39;</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;result&#39;</span><span class="p">],</span> <span class="mi">30</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;calc_name&#39;</span><span class="p">],</span> <span class="s1">&#39;MyCalc_used&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsInstance</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;calc&#39;</span><span class="p">],</span> <span class="n">module</span><span class="o">.</span><span class="n">Calculator</span><span class="p">)</span>
</pre></div>
</div>
</details></section>
<section id="load-main-with-selective-collection">
<span id="unittests-unittest2doc-utils-exec-tool-load-main-with-selective-collection"></span><h2>load_main_with_selective_collection<a class="headerlink" href="#load-main-with-selective-collection" title="Link to this heading">¶</a></h2>
<p>Test load_main with selective attribute collection using helper functions.</p>
<details class="summary-input">
<summary>INPUT</summary><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">test_load_main_with_selective_collection</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test load_main with selective attribute collection using helper functions.&quot;&quot;&quot;</span>
    <span class="n">test_content</span> <span class="o">=</span> <span class="n">dedent</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">        def greet(name):</span>
<span class="s1">            return f&quot;Hello, </span><span class="si">{name}</span><span class="s1">!&quot;</span>

<span class="s1">        def calculate(a, b):</span>
<span class="s1">            return a * b</span>

<span class="s1">        BASE_VALUE = 10</span>
<span class="s1">        SECRET = &quot;should not be visible&quot;</span>

<span class="s1">        if __name__ == &quot;__main__&quot;:</span>
<span class="s1">            greeting = greet(&quot;World&quot;)</span>
<span class="s1">            result = calculate(BASE_VALUE, 5)</span>
<span class="s1">            total = BASE_VALUE + result</span>
<span class="s1">    &#39;&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

    <span class="k">with</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">NamedTemporaryFile</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">suffix</span><span class="o">=</span><span class="s1">&#39;.py&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">test_content</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>

        <span class="c1"># Use helper functions to selectively collect</span>
        <span class="n">module</span> <span class="o">=</span> <span class="n">load_module</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">test_globals</span> <span class="o">=</span> <span class="n">collect_module_attr</span><span class="p">(</span>
            <span class="n">module</span><span class="p">,</span>
            <span class="n">names</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;BASE_VALUE&#39;</span><span class="p">],</span>  <span class="c1"># use list format for original names</span>
            <span class="n">functions</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertNotIn</span><span class="p">(</span><span class="s1">&#39;SECRET&#39;</span><span class="p">,</span> <span class="n">test_globals</span><span class="p">)</span>

        <span class="n">result</span> <span class="o">=</span> <span class="n">load_main</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="nb">globals</span><span class="o">=</span><span class="n">test_globals</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s1">&#39;greeting&#39;</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s1">&#39;result&#39;</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s1">&#39;total&#39;</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;greeting&#39;</span><span class="p">],</span> <span class="s1">&#39;Hello, World!&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;result&#39;</span><span class="p">],</span> <span class="mi">50</span><span class="p">)</span>  <span class="c1"># 10 * 5</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;total&#39;</span><span class="p">],</span> <span class="mi">60</span><span class="p">)</span>   <span class="c1"># 10 + 50</span>
</pre></div>
</div>
</details></section>
<section id="load-main-with-custom-locals">
<span id="unittests-unittest2doc-utils-exec-tool-load-main-with-custom-locals"></span><h2>load_main_with_custom_locals<a class="headerlink" href="#load-main-with-custom-locals" title="Link to this heading">¶</a></h2>
<p>Test load_main with custom locals using helper functions.</p>
<details class="summary-input">
<summary>INPUT</summary><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">test_load_main_with_custom_locals</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test load_main with custom locals using helper functions.&quot;&quot;&quot;</span>
    <span class="n">test_content</span> <span class="o">=</span> <span class="n">dedent</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">        def multiply(a, b):</span>
<span class="s1">            return a * b</span>

<span class="s1">        BASE_VALUE = 5</span>

<span class="s1">        if __name__ == &quot;__main__&quot;:</span>
<span class="s1">            result = multiply(BASE_VALUE, existing_multiplier)</span>
<span class="s1">            final_value = result + existing_offset</span>
<span class="s1">    &#39;&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

    <span class="k">with</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">NamedTemporaryFile</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">suffix</span><span class="o">=</span><span class="s1">&#39;.py&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">test_content</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>

        <span class="c1"># Use helper functions with specific classes and functions</span>
        <span class="n">module</span> <span class="o">=</span> <span class="n">load_module</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">test_globals</span> <span class="o">=</span> <span class="n">collect_module_attr</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">functions</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">classes</span><span class="o">=</span><span class="p">[</span><span class="nb">int</span><span class="p">])</span>

        <span class="n">custom_locals</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;existing_multiplier&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
            <span class="s1">&#39;existing_offset&#39;</span><span class="p">:</span> <span class="mi">10</span>
        <span class="p">}</span>

        <span class="n">result</span> <span class="o">=</span> <span class="n">load_main</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="nb">locals</span><span class="o">=</span><span class="n">custom_locals</span><span class="p">,</span> <span class="nb">globals</span><span class="o">=</span><span class="n">test_globals</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s1">&#39;existing_multiplier&#39;</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s1">&#39;existing_offset&#39;</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s1">&#39;result&#39;</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s1">&#39;final_value&#39;</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;result&#39;</span><span class="p">],</span> <span class="mi">15</span><span class="p">)</span>  <span class="c1"># 5 * 3</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;final_value&#39;</span><span class="p">],</span> <span class="mi">25</span><span class="p">)</span>  <span class="c1"># 15 + 10</span>
</pre></div>
</div>
</details></section>
<section id="load-main-with-code-filter">
<span id="unittests-unittest2doc-utils-exec-tool-load-main-with-code-filter"></span><h2>load_main_with_code_filter<a class="headerlink" href="#load-main-with-code-filter" title="Link to this heading">¶</a></h2>
<p>Test load_main with code filter using helper functions.</p>
<details class="summary-input">
<summary>INPUT</summary><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">test_load_main_with_code_filter</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test load_main with code filter using helper functions.&quot;&quot;&quot;</span>
    <span class="n">test_content</span> <span class="o">=</span> <span class="n">dedent</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">        def process_data(data):</span>
<span class="s1">            return data.upper()</span>

<span class="s1">        DEFAULT_DATA = &quot;hello world&quot;</span>

<span class="s1">        if __name__ == &quot;__main__&quot;:</span>
<span class="s1">            processed = process_data(DEFAULT_DATA)</span>
<span class="s1">            length = len(processed)</span>
<span class="s1">    &#39;&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

    <span class="k">with</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">NamedTemporaryFile</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">suffix</span><span class="o">=</span><span class="s1">&#39;.py&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">test_content</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>

        <span class="c1"># Use helper functions</span>
        <span class="n">module</span> <span class="o">=</span> <span class="n">load_module</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">test_globals</span> <span class="o">=</span> <span class="n">collect_module_attr</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="nb">all</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">add_prefix_filter</span><span class="p">(</span><span class="n">code</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;prefix_var = &#39;code_filtered&#39;</span><span class="se">\n</span><span class="si">{</span><span class="n">code</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="n">result</span> <span class="o">=</span> <span class="n">load_main</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">code_filter</span><span class="o">=</span><span class="n">add_prefix_filter</span><span class="p">,</span> <span class="nb">globals</span><span class="o">=</span><span class="n">test_globals</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s1">&#39;prefix_var&#39;</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s1">&#39;processed&#39;</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s1">&#39;length&#39;</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;prefix_var&#39;</span><span class="p">],</span> <span class="s1">&#39;code_filtered&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;processed&#39;</span><span class="p">],</span> <span class="s1">&#39;HELLO WORLD&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;length&#39;</span><span class="p">],</span> <span class="mi">11</span><span class="p">)</span>
</pre></div>
</div>
</details></section>
<section id="load-main-with-name-mapping">
<span id="unittests-unittest2doc-utils-exec-tool-load-main-with-name-mapping"></span><h2>load_main_with_name_mapping<a class="headerlink" href="#load-main-with-name-mapping" title="Link to this heading">¶</a></h2>
<p>Test load_main with name mapping using helper functions.</p>
<details class="summary-input">
<summary>INPUT</summary><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">test_load_main_with_name_mapping</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test load_main with name mapping using helper functions.&quot;&quot;&quot;</span>
    <span class="n">test_content</span> <span class="o">=</span> <span class="n">dedent</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">        def calculate_area(radius):</span>
<span class="s1">            import math</span>
<span class="s1">            return math.pi * radius ** 2</span>

<span class="s1">        def calculate_volume(radius, height):</span>
<span class="s1">            import math</span>
<span class="s1">            return math.pi * radius ** 2 * height</span>

<span class="s1">        DEFAULT_RADIUS = 5</span>
<span class="s1">        DEFAULT_HEIGHT = 10</span>

<span class="s1">        if __name__ == &quot;__main__&quot;:</span>
<span class="s1">            area = calculate_area(DEFAULT_RADIUS)</span>
<span class="s1">            volume = calculate_volume(DEFAULT_RADIUS, DEFAULT_HEIGHT)</span>
<span class="s1">            summary = f&quot;Area: </span><span class="si">{area:.2f}</span><span class="s1">, Volume: </span><span class="si">{volume:.2f}</span><span class="s1">&quot;</span>
<span class="s1">    &#39;&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

    <span class="k">with</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">NamedTemporaryFile</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">suffix</span><span class="o">=</span><span class="s1">&#39;.py&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">test_content</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>

        <span class="c1"># Use helper functions with selective collection (without name mapping to avoid conflicts)</span>
        <span class="n">module</span> <span class="o">=</span> <span class="n">load_module</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">test_globals</span> <span class="o">=</span> <span class="n">collect_module_attr</span><span class="p">(</span>
            <span class="n">module</span><span class="p">,</span>
            <span class="n">functions</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>  <span class="c1"># Get all functions with original names</span>
            <span class="n">classes</span><span class="o">=</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span>    <span class="c1"># Get integer constants</span>
        <span class="p">)</span>

        <span class="n">result</span> <span class="o">=</span> <span class="n">load_main</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="nb">globals</span><span class="o">=</span><span class="n">test_globals</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s1">&#39;area&#39;</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s1">&#39;volume&#39;</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s1">&#39;summary&#39;</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;area&#39;</span><span class="p">],</span> <span class="mf">78.53981633974483</span><span class="p">,</span> <span class="n">places</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;volume&#39;</span><span class="p">],</span> <span class="mf">785.3981633974483</span><span class="p">,</span> <span class="n">places</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
</pre></div>
</div>
</details></section>
<section id="load-main-complex-main-block">
<span id="unittests-unittest2doc-utils-exec-tool-load-main-complex-main-block"></span><h2>load_main_complex_main_block<a class="headerlink" href="#load-main-complex-main-block" title="Link to this heading">¶</a></h2>
<p>Test load_main with complex main block using helper functions.</p>
<details class="summary-input">
<summary>INPUT</summary><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">test_load_main_complex_main_block</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test load_main with complex main block using helper functions.&quot;&quot;&quot;</span>
    <span class="n">test_content</span> <span class="o">=</span> <span class="n">dedent</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">        def fibonacci(n):</span>
<span class="s1">            if n &lt;= 1:</span>
<span class="s1">                return n</span>
<span class="s1">            return fibonacci(n-1) + fibonacci(n-2)</span>

<span class="s1">        def is_even(num):</span>
<span class="s1">            return num % 2 == 0</span>

<span class="s1">        LIMIT = 8</span>

<span class="s1">        if __name__ == &quot;__main__&quot;:</span>
<span class="s1">            fib_numbers = []</span>
<span class="s1">            for i in range(LIMIT):</span>
<span class="s1">                fib_numbers.append(fibonacci(i))</span>

<span class="s1">            even_fibs = [num for num in fib_numbers if is_even(num)]</span>

<span class="s1">            if len(even_fibs) &gt; 0:</span>
<span class="s1">                max_even_fib = max(even_fibs)</span>
<span class="s1">                result_status = &quot;found_evens&quot;</span>
<span class="s1">            else:</span>
<span class="s1">                max_even_fib = 0</span>
<span class="s1">                result_status = &quot;no_evens&quot;</span>

<span class="s1">            total_sum = sum(fib_numbers)</span>
<span class="s1">    &#39;&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

    <span class="k">with</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">NamedTemporaryFile</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">suffix</span><span class="o">=</span><span class="s1">&#39;.py&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">test_content</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>

        <span class="c1"># Use helper functions</span>
        <span class="n">module</span> <span class="o">=</span> <span class="n">load_module</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">test_globals</span> <span class="o">=</span> <span class="n">collect_module_attr</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="nb">all</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="n">result</span> <span class="o">=</span> <span class="n">load_main</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="nb">globals</span><span class="o">=</span><span class="n">test_globals</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s1">&#39;fib_numbers&#39;</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s1">&#39;even_fibs&#39;</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s1">&#39;max_even_fib&#39;</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s1">&#39;result_status&#39;</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s1">&#39;total_sum&#39;</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span>

        <span class="c1"># Check fibonacci sequence: [0, 1, 1, 2, 3, 5, 8, 13]</span>
        <span class="n">expected_fibs</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">13</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;fib_numbers&#39;</span><span class="p">],</span> <span class="n">expected_fibs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;even_fibs&#39;</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">8</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;max_even_fib&#39;</span><span class="p">],</span> <span class="mi">8</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;result_status&#39;</span><span class="p">],</span> <span class="s1">&#39;found_evens&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;total_sum&#39;</span><span class="p">],</span> <span class="mi">33</span><span class="p">)</span>
</pre></div>
</div>
</details></section>
<section id="load-main-with-module-object">
<span id="unittests-unittest2doc-utils-exec-tool-load-main-with-module-object"></span><h2>load_main_with_module_object<a class="headerlink" href="#load-main-with-module-object" title="Link to this heading">¶</a></h2>
<p>Test load_main with actual module object using helper functions.</p>
<details class="summary-input">
<summary>INPUT</summary><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">test_load_main_with_module_object</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test load_main with actual module object using helper functions.&quot;&quot;&quot;</span>
    <span class="n">test_content</span> <span class="o">=</span> <span class="n">dedent</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">        def get_message():</span>
<span class="s1">            return &quot;from module object&quot;</span>

<span class="s1">        CONFIG_VALUE = &quot;test_config&quot;</span>

<span class="s1">        if __name__ == &quot;__main__&quot;:</span>
<span class="s1">            message = get_message()</span>
<span class="s1">            config = CONFIG_VALUE.upper()</span>
<span class="s1">            combined = f&quot;</span><span class="si">{message}</span><span class="s1">_</span><span class="si">{config}</span><span class="s1">&quot;</span>
<span class="s1">    &#39;&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

    <span class="k">with</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">NamedTemporaryFile</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">suffix</span><span class="o">=</span><span class="s1">&#39;.py&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">test_content</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>

        <span class="c1"># Use helper functions</span>
        <span class="n">module</span> <span class="o">=</span> <span class="n">load_module</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">test_globals</span> <span class="o">=</span> <span class="n">collect_module_attr</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="nb">all</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Test with module object instead of file path</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">load_main</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="nb">globals</span><span class="o">=</span><span class="n">test_globals</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s1">&#39;config&#39;</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s1">&#39;combined&#39;</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;message&#39;</span><span class="p">],</span> <span class="s1">&#39;from module object&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;config&#39;</span><span class="p">],</span> <span class="s1">&#39;TEST_CONFIG&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;combined&#39;</span><span class="p">],</span> <span class="s1">&#39;from module object_TEST_CONFIG&#39;</span><span class="p">)</span>
</pre></div>
</div>
</details></section>
<section id="load-main-integration-complex">
<span id="unittests-unittest2doc-utils-exec-tool-load-main-integration-complex"></span><h2>load_main_integration_complex<a class="headerlink" href="#load-main-integration-complex" title="Link to this heading">¶</a></h2>
<p>Test complex integration example with all features using helper functions.</p>
<details class="summary-input">
<summary>INPUT</summary><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">test_load_main_integration_complex</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test complex integration example with all features using helper functions.&quot;&quot;&quot;</span>
    <span class="n">test_content</span> <span class="o">=</span> <span class="n">dedent</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">        import math</span>

<span class="s1">        def fibonacci(n):</span>
<span class="s1">            if n &lt;= 1:</span>
<span class="s1">                return n</span>
<span class="s1">            return fibonacci(n-1) + fibonacci(n-2)</span>

<span class="s1">        def is_prime(num):</span>
<span class="s1">            if num &lt; 2:</span>
<span class="s1">                return False</span>
<span class="s1">            for i in range(2, int(math.sqrt(num)) + 1):</span>
<span class="s1">                if num </span><span class="si">% i</span><span class="s1"> == 0:</span>
<span class="s1">                    return False</span>
<span class="s1">            return True</span>

<span class="s1">        PI_APPROX = 3.14</span>
<span class="s1">        LIMIT = 10</span>

<span class="s1">        if __name__ == &quot;__main__&quot;:</span>
<span class="s1">            # Calculate fibonacci numbers</span>
<span class="s1">            fib_numbers = [fibonacci(i) for i in range(LIMIT)]</span>

<span class="s1">            # Find prime fibonacci numbers</span>
<span class="s1">            prime_fibs = [num for num in fib_numbers if is_prime(num)]</span>

<span class="s1">            # Use math module</span>
<span class="s1">            circle_area = math.pi * (5 ** 2)</span>
<span class="s1">            pi_accuracy = abs(math.pi - PI_APPROX) &lt; 0.01</span>

<span class="s1">            # Summary</span>
<span class="s1">            result_summary = {</span>
<span class="s1">                &#39;fibonacci_count&#39;: len(fib_numbers),</span>
<span class="s1">                &#39;prime_fibonacci&#39;: prime_fibs,</span>
<span class="s1">                &#39;circle_area&#39;: round(circle_area, 2),</span>
<span class="s1">                &#39;pi_is_accurate&#39;: pi_accuracy</span>
<span class="s1">            }</span>
<span class="s1">    &#39;&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

    <span class="k">with</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">NamedTemporaryFile</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">suffix</span><span class="o">=</span><span class="s1">&#39;.py&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">test_content</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>

        <span class="c1"># Use helper functions - need to include math module</span>
        <span class="n">module</span> <span class="o">=</span> <span class="n">load_module</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">test_globals</span> <span class="o">=</span> <span class="n">collect_module_attr</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="nb">all</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>  <span class="c1"># Include everything including imported modules</span>

        <span class="n">result</span> <span class="o">=</span> <span class="n">load_main</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="nb">globals</span><span class="o">=</span><span class="n">test_globals</span><span class="p">)</span>

        <span class="c1"># Verify results</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s1">&#39;fib_numbers&#39;</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s1">&#39;prime_fibs&#39;</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s1">&#39;circle_area&#39;</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s1">&#39;result_summary&#39;</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span>

        <span class="n">expected_fibs</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">21</span><span class="p">,</span> <span class="mi">34</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;fib_numbers&#39;</span><span class="p">],</span> <span class="n">expected_fibs</span><span class="p">)</span>

        <span class="c1"># Prime fibonacci numbers up to 34: [2, 3, 5, 13]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;prime_fibs&#39;</span><span class="p">],</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">13</span><span class="p">])</span>

        <span class="n">summary</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s1">&#39;result_summary&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">summary</span><span class="p">[</span><span class="s1">&#39;fibonacci_count&#39;</span><span class="p">],</span> <span class="mi">10</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">summary</span><span class="p">[</span><span class="s1">&#39;prime_fibonacci&#39;</span><span class="p">],</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">13</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">summary</span><span class="p">[</span><span class="s1">&#39;circle_area&#39;</span><span class="p">],</span> <span class="mf">78.54</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">summary</span><span class="p">[</span><span class="s1">&#39;pi_is_accurate&#39;</span><span class="p">])</span>
</pre></div>
</div>
</details></section>
<section id="load-main-error-cases">
<span id="unittests-unittest2doc-utils-exec-tool-load-main-error-cases"></span><h2>load_main_error_cases<a class="headerlink" href="#load-main-error-cases" title="Link to this heading">¶</a></h2>
<p>Test load_main error cases.</p>
<details class="summary-input">
<summary>INPUT</summary><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">test_load_main_error_cases</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test load_main error cases.&quot;&quot;&quot;</span>
    <span class="c1"># Non-existent file</span>
    <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">FileNotFoundError</span><span class="p">):</span>
        <span class="n">load_main</span><span class="p">(</span><span class="s2">&quot;nonexistent_file_12345.py&quot;</span><span class="p">)</span>

    <span class="c1"># File with no main block</span>
    <span class="n">test_content</span> <span class="o">=</span> <span class="n">dedent</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">        def function():</span>
<span class="s1">            return &quot;no main block&quot;</span>

<span class="s1">        variable = 42</span>
<span class="s1">    &#39;&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

    <span class="k">with</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">NamedTemporaryFile</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">suffix</span><span class="o">=</span><span class="s1">&#39;.py&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">test_content</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>

        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">)</span> <span class="k">as</span> <span class="n">cm</span><span class="p">:</span>
            <span class="n">load_main</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s2">&quot;No &#39;if __name__ == </span><span class="se">\&quot;</span><span class="s2">__main__</span><span class="se">\&quot;</span><span class="s2">&#39; block found&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">cm</span><span class="o">.</span><span class="n">exception</span><span class="p">))</span>

    <span class="c1"># Syntax error</span>
    <span class="n">test_content_broken</span> <span class="o">=</span> <span class="n">dedent</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">        def broken_function(</span>
<span class="s1">            # Missing closing parenthesis</span>

<span class="s1">        if __name__ == &quot;__main__&quot;:</span>
<span class="s1">            result = &quot;never reached&quot;</span>
<span class="s1">    &#39;&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

    <span class="k">with</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">NamedTemporaryFile</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">suffix</span><span class="o">=</span><span class="s1">&#39;.py&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">test_content_broken</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>

        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">SyntaxError</span><span class="p">):</span>
            <span class="n">load_main</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</pre></div>
</div>
</details></section>
<section id="load-main-with-add-code-object">
<span id="unittests-unittest2doc-utils-exec-tool-load-main-with-add-code-object"></span><h2>load_main_with_add_code_object<a class="headerlink" href="#load-main-with-add-code-object" title="Link to this heading">¶</a></h2>
<p>Test load_main with add_code_object=True for inspect.getsource() support.</p>
<details class="summary-input">
<summary>INPUT</summary><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">test_load_main_with_add_code_object</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test load_main with add_code_object=True for inspect.getsource() support.&quot;&quot;&quot;</span>
    <span class="n">test_content</span> <span class="o">=</span> <span class="n">dedent</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">        def helper_function(x):</span>
<span class="s1">            &quot;&quot;&quot;A helper function.&quot;&quot;&quot;</span>
<span class="s1">            return x * 2</span>

<span class="s1">        BASE_VALUE = 10</span>

<span class="s1">        if __name__ == &quot;__main__&quot;:</span>
<span class="s1">            def main_function(y):</span>
<span class="s1">                &quot;&quot;&quot;Function defined in main block.&quot;&quot;&quot;</span>
<span class="s1">                return helper_function(y) + BASE_VALUE</span>

<span class="s1">            class MainClass:</span>
<span class="s1">                &quot;&quot;&quot;Class defined in main block.&quot;&quot;&quot;</span>
<span class="s1">                def __init__(self, value):</span>
<span class="s1">                    self.value = value</span>

<span class="s1">                def get_value(self):</span>
<span class="s1">                    return self.value * 2</span>

<span class="s1">            result = main_function(5)</span>
<span class="s1">            instance = MainClass(10)</span>
<span class="s1">            class_result = instance.get_value()</span>
<span class="s1">    &#39;&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

    <span class="k">with</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">NamedTemporaryFile</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">suffix</span><span class="o">=</span><span class="s1">&#39;.py&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">test_content</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>

        <span class="c1"># Use helper functions</span>
        <span class="n">module</span> <span class="o">=</span> <span class="n">load_module</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">test_globals</span> <span class="o">=</span> <span class="n">collect_module_attr</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="nb">all</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Test with add_code_object=True</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">load_main</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">add_code_object</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="nb">globals</span><span class="o">=</span><span class="n">test_globals</span><span class="p">)</span>

        <span class="c1"># Verify objects exist</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s1">&#39;main_function&#39;</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s1">&#39;MainClass&#39;</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s1">&#39;result&#39;</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s1">&#39;instance&#39;</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s1">&#39;class_result&#39;</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span>

        <span class="c1"># Test function</span>
        <span class="n">main_func</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s1">&#39;main_function&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">main_func</span><span class="p">(</span><span class="mi">5</span><span class="p">),</span> <span class="mi">20</span><span class="p">)</span>  <span class="c1"># 5*2 + 10 = 20</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;result&#39;</span><span class="p">],</span> <span class="mi">20</span><span class="p">)</span>

        <span class="c1"># Test class</span>
        <span class="n">main_class</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s1">&#39;MainClass&#39;</span><span class="p">]</span>
        <span class="n">instance</span> <span class="o">=</span> <span class="n">main_class</span><span class="p">(</span><span class="mi">15</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">instance</span><span class="o">.</span><span class="n">get_value</span><span class="p">(),</span> <span class="mi">30</span><span class="p">)</span>  <span class="c1"># 15 * 2 = 30</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;class_result&#39;</span><span class="p">],</span> <span class="mi">20</span><span class="p">)</span>  <span class="c1"># 10 * 2 = 20</span>

        <span class="c1"># Test comprehensive source code information for all objects</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">=== Detailed source code info test ===&quot;</span><span class="p">)</span>

        <span class="c1"># Test all functions and classes</span>
        <span class="n">test_objects</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;main_function&#39;</span><span class="p">:</span> <span class="n">main_func</span><span class="p">,</span>
            <span class="s1">&#39;MainClass&#39;</span><span class="p">:</span> <span class="n">main_class</span>
        <span class="p">}</span>

        <span class="k">for</span> <span class="n">obj_name</span><span class="p">,</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">test_objects</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">--- Testing </span><span class="si">{</span><span class="n">obj_name</span><span class="si">}</span><span class="s2"> ---&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">inspect</span><span class="o">.</span><span class="n">isclass</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Type: class&quot;</span><span class="p">)</span>
                <span class="c1"># Test class source</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="nb">hasattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="s1">&#39;__source__&#39;</span><span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">obj_name</span><span class="si">}</span><span class="s2"> missing __source__ attribute&quot;</span><span class="p">)</span>
                <span class="n">class_source</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">__source__</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;class </span><span class="si">{</span><span class="n">obj</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s1">:&#39;</span><span class="p">,</span> <span class="n">class_source</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;✓ Class source length: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">class_source</span><span class="p">)</span><span class="si">}</span><span class="s2"> chars&quot;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;✓ Virtual file: </span><span class="si">{</span><span class="nb">getattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;__module__&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;N/A&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;✓ File attribute: </span><span class="si">{</span><span class="nb">getattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;__file__&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;N/A&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

                <span class="c1"># Test all methods in the class</span>
                <span class="k">for</span> <span class="n">method_name</span> <span class="ow">in</span> <span class="nb">dir</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
                    <span class="n">method</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">method_name</span><span class="p">)</span>
                    <span class="c1"># Check if it&#39;s a method we want to test</span>
                    <span class="k">if</span> <span class="nb">callable</span><span class="p">(</span><span class="n">method</span><span class="p">):</span>
                        <span class="c1"># Include special methods like __init__ and user-defined methods</span>
                        <span class="n">should_test</span> <span class="o">=</span> <span class="p">(</span>
                            <span class="n">method_name</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;__init__&#39;</span><span class="p">,</span> <span class="s1">&#39;method&#39;</span><span class="p">,</span> <span class="s1">&#39;get_value&#39;</span><span class="p">,</span> <span class="s1">&#39;static_method&#39;</span><span class="p">]</span> <span class="ow">or</span>
                            <span class="p">(</span><span class="ow">not</span> <span class="n">method_name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;__&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">method_name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">))</span>
                        <span class="p">)</span>

                        <span class="k">if</span> <span class="n">should_test</span><span class="p">:</span>
                            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Testing method: </span><span class="si">{</span><span class="n">method_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                            <span class="c1"># Check if it&#39;s an instance method with __func__</span>
                            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">method</span><span class="p">,</span> <span class="s1">&#39;__func__&#39;</span><span class="p">):</span>
                                <span class="k">try</span><span class="p">:</span>
                                    <span class="n">method_source</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">getsource</span><span class="p">(</span><span class="n">method</span><span class="p">)</span>
                                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    ✓ inspect.getsource() success: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">method_source</span><span class="p">)</span><span class="si">}</span><span class="s2"> chars&quot;</span><span class="p">)</span>
                                    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">method</span><span class="o">.</span><span class="vm">__func__</span><span class="p">,</span> <span class="s1">&#39;__code__&#39;</span><span class="p">):</span>
                                        <span class="n">code</span> <span class="o">=</span> <span class="n">method</span><span class="o">.</span><span class="vm">__func__</span><span class="o">.</span><span class="vm">__code__</span>
                                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    ✓ Filename: </span><span class="si">{</span><span class="n">code</span><span class="o">.</span><span class="n">co_filename</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    ✓ First line: </span><span class="si">{</span><span class="n">code</span><span class="o">.</span><span class="n">co_firstlineno</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;===source===&quot;</span><span class="p">)</span>
                                    <span class="nb">print</span><span class="p">(</span><span class="n">method_source</span><span class="p">)</span>
                                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;============&quot;</span><span class="p">)</span>
                                <span class="k">except</span> <span class="p">(</span><span class="ne">OSError</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    ✗ inspect.getsource() failed: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                            <span class="c1"># Check if it&#39;s a static method or other callable</span>
                            <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">method</span><span class="p">,</span> <span class="s1">&#39;__code__&#39;</span><span class="p">):</span>
                                <span class="k">try</span><span class="p">:</span>
                                    <span class="n">method_source</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">getsource</span><span class="p">(</span><span class="n">method</span><span class="p">)</span>
                                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    ✓ inspect.getsource() success: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">method_source</span><span class="p">)</span><span class="si">}</span><span class="s2"> chars&quot;</span><span class="p">)</span>
                                    <span class="n">code</span> <span class="o">=</span> <span class="n">method</span><span class="o">.</span><span class="vm">__code__</span>
                                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    ✓ Filename: </span><span class="si">{</span><span class="n">code</span><span class="o">.</span><span class="n">co_filename</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    ✓ First line: </span><span class="si">{</span><span class="n">code</span><span class="o">.</span><span class="n">co_firstlineno</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;===source===&quot;</span><span class="p">)</span>
                                    <span class="nb">print</span><span class="p">(</span><span class="n">method_source</span><span class="p">)</span>
                                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;============&quot;</span><span class="p">)</span>
                                <span class="k">except</span> <span class="p">(</span><span class="ne">OSError</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    ✗ inspect.getsource() failed: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    • Skipped built-in method or attribute&quot;</span><span class="p">)</span>

                <span class="c1"># Try inspect.getsource on class (may fail for dynamic classes)</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">inspect_class_source</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">getsource</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;✓ Class inspect.getsource() success: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">inspect_class_source</span><span class="p">)</span><span class="si">}</span><span class="s2"> chars&quot;</span><span class="p">)</span>
                <span class="k">except</span> <span class="p">(</span><span class="ne">OSError</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;✗ Class inspect.getsource() failed: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2"> (expected)&quot;</span><span class="p">)</span>

            <span class="k">elif</span> <span class="nb">callable</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Type: function&quot;</span><span class="p">)</span>
                <span class="c1"># Test function source</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="nb">hasattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="s1">&#39;__source__&#39;</span><span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">obj_name</span><span class="si">}</span><span class="s2"> missing __source__ attribute&quot;</span><span class="p">)</span>
                <span class="n">func_source</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">__source__</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;def </span><span class="si">{</span><span class="n">obj</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s1">(&#39;</span><span class="p">,</span> <span class="n">func_source</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;✓ Function source length: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">func_source</span><span class="p">)</span><span class="si">}</span><span class="s2"> chars&quot;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;✓ Virtual module: </span><span class="si">{</span><span class="nb">getattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;__module__&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;N/A&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="s1">&#39;__code__&#39;</span><span class="p">):</span>
                    <span class="n">code</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="vm">__code__</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;✓ Code object filename: </span><span class="si">{</span><span class="n">code</span><span class="o">.</span><span class="n">co_filename</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;✓ Code object first line: </span><span class="si">{</span><span class="n">code</span><span class="o">.</span><span class="n">co_firstlineno</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

                <span class="c1"># Test inspect.getsource for functions (should work)</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">inspect_func_source</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">getsource</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;✓ inspect.getsource() success: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">inspect_func_source</span><span class="p">)</span><span class="si">}</span><span class="s2"> chars&quot;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;def </span><span class="si">{</span><span class="n">obj</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s1">(&#39;</span><span class="p">,</span> <span class="n">inspect_func_source</span><span class="p">)</span>
                <span class="k">except</span> <span class="p">(</span><span class="ne">OSError</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;✗ inspect.getsource() failed: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">fail</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Function </span><span class="si">{</span><span class="n">obj_name</span><span class="si">}</span><span class="s2"> inspect.getsource() should work&quot;</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">=== Source code info test complete ===</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</details><details class="summary-output" open>
<summary>OUTPUT</summary><div class="highlight-default notranslate"><div class="highlight"><pre><span></span>=== Detailed source code info test ===

--- Testing main_function ---
Type: function
✓ Function source length: 106 chars
✓ Virtual module: &lt;load_main:tmplgmweslk.py&gt;
✓ Code object filename: &lt;load_main:tmplgmweslk.py&gt;
✓ Code object first line: 8
✓ inspect.getsource() success: 119 chars

--- Testing MainClass ---
Type: class
✓ Class source length: 169 chars
✓ Virtual file: &lt;load_main:tmplgmweslk.py&gt;
✓ File attribute: &lt;load_main:tmplgmweslk.py&gt;
  Testing method: __init__
    ✓ inspect.getsource() success: 66 chars
    ✓ Filename: &lt;load_main:tmplgmweslk.py&gt;
    ✓ First line: 14
===source===
        def __init__(self, value):
            self.value = value

============
  Testing method: get_value
    ✓ inspect.getsource() success: 63 chars
    ✓ Filename: &lt;load_main:tmplgmweslk.py&gt;
    ✓ First line: 17
===source===
        def get_value(self):
            return self.value * 2

============
✗ Class inspect.getsource() failed: &lt;class &#39;&lt;load_main:tmplgmweslk.py&gt;.MainClass&#39;&gt; is a built-in class (expected)

=== Source code info test complete ===
</pre></div>
</div>
</details></section>
<section id="load-main-add-code-object-complex">
<span id="unittests-unittest2doc-utils-exec-tool-load-main-add-code-object-complex"></span><h2>load_main_add_code_object_complex<a class="headerlink" href="#load-main-add-code-object-complex" title="Link to this heading">¶</a></h2>
<p>Test add_code_object with nested functions and async functions.</p>
<details class="summary-input">
<summary>INPUT</summary><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">test_load_main_add_code_object_complex</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test add_code_object with nested functions and async functions.&quot;&quot;&quot;</span>
    <span class="n">test_content</span> <span class="o">=</span> <span class="n">dedent</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">        import asyncio</span>

<span class="s1">        def outer_function():</span>
<span class="s1">            return &quot;outer&quot;</span>

<span class="s1">        if __name__ == &quot;__main__&quot;:</span>
<span class="s1">            def nested_function():</span>
<span class="s1">                def inner_function():</span>
<span class="s1">                    return &quot;inner&quot;</span>
<span class="s1">                return inner_function</span>

<span class="s1">            async def async_function():</span>
<span class="s1">                return &quot;async&quot;</span>

<span class="s1">            class ComplexClass:</span>
<span class="s1">                def __init__(self):</span>
<span class="s1">                    self.value = &quot;complex&quot;</span>

<span class="s1">                def method(self):</span>
<span class="s1">                    return self.value</span>

<span class="s1">                @staticmethod</span>
<span class="s1">                def static_method():</span>
<span class="s1">                    return &quot;static&quot;</span>

<span class="s1">            inner_func = nested_function()</span>
<span class="s1">            complex_instance = ComplexClass()</span>
<span class="s1">    &#39;&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

    <span class="k">with</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">NamedTemporaryFile</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">suffix</span><span class="o">=</span><span class="s1">&#39;.py&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">test_content</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>

        <span class="c1"># Use helper functions</span>
        <span class="n">module</span> <span class="o">=</span> <span class="n">load_module</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">test_globals</span> <span class="o">=</span> <span class="n">collect_module_attr</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="nb">all</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="n">result</span> <span class="o">=</span> <span class="n">load_main</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">add_code_object</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="nb">globals</span><span class="o">=</span><span class="n">test_globals</span><span class="p">)</span>

        <span class="c1"># Test nested function</span>
        <span class="n">nested_func</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s1">&#39;nested_function&#39;</span><span class="p">]</span>
        <span class="n">inner_func</span> <span class="o">=</span> <span class="n">nested_func</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">inner_func</span><span class="p">(),</span> <span class="s2">&quot;inner&quot;</span><span class="p">)</span>

        <span class="c1"># Test async function</span>
        <span class="n">async_func</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s1">&#39;async_function&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">asyncio</span><span class="o">.</span><span class="n">iscoroutinefunction</span><span class="p">(</span><span class="n">async_func</span><span class="p">))</span>

        <span class="c1"># Test complex class</span>
        <span class="n">complex_class</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s1">&#39;ComplexClass&#39;</span><span class="p">]</span>
        <span class="n">instance</span> <span class="o">=</span> <span class="n">complex_class</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">instance</span><span class="o">.</span><span class="n">method</span><span class="p">(),</span> <span class="s2">&quot;complex&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">complex_class</span><span class="o">.</span><span class="n">static_method</span><span class="p">(),</span> <span class="s2">&quot;static&quot;</span><span class="p">)</span>

        <span class="c1"># Test comprehensive source code information for all complex objects</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">=== Detailed source code info test ===&quot;</span><span class="p">)</span>

        <span class="c1"># Test all functions and classes</span>
        <span class="n">test_objects</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;nested_function&#39;</span><span class="p">:</span> <span class="n">nested_func</span><span class="p">,</span>
            <span class="s1">&#39;async_function&#39;</span><span class="p">:</span> <span class="n">async_func</span><span class="p">,</span>
            <span class="s1">&#39;ComplexClass&#39;</span><span class="p">:</span> <span class="n">complex_class</span>
        <span class="p">}</span>

        <span class="k">for</span> <span class="n">obj_name</span><span class="p">,</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">test_objects</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">--- Testing </span><span class="si">{</span><span class="n">obj_name</span><span class="si">}</span><span class="s2"> ---&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">inspect</span><span class="o">.</span><span class="n">isclass</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Type: complex class&quot;</span><span class="p">)</span>
                <span class="c1"># Test class source</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="nb">hasattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="s1">&#39;__source__&#39;</span><span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">obj_name</span><span class="si">}</span><span class="s2"> missing __source__ attribute&quot;</span><span class="p">)</span>
                <span class="n">class_source</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">__source__</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;class </span><span class="si">{</span><span class="n">obj</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s1">:&#39;</span><span class="p">,</span> <span class="n">class_source</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;✓ Class source length: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">class_source</span><span class="p">)</span><span class="si">}</span><span class="s2"> chars&quot;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;✓ Virtual file: </span><span class="si">{</span><span class="nb">getattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;__module__&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;N/A&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;✓ File attribute: </span><span class="si">{</span><span class="nb">getattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;__file__&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;N/A&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

                <span class="c1"># Test all methods in the class</span>
                <span class="k">for</span> <span class="n">method_name</span> <span class="ow">in</span> <span class="nb">dir</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
                    <span class="n">method</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">method_name</span><span class="p">)</span>
                    <span class="c1"># Check if it&#39;s a method we want to test</span>
                    <span class="k">if</span> <span class="nb">callable</span><span class="p">(</span><span class="n">method</span><span class="p">):</span>
                        <span class="c1"># Include special methods like __init__ and user-defined methods</span>
                        <span class="n">should_test</span> <span class="o">=</span> <span class="p">(</span>
                            <span class="n">method_name</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;__init__&#39;</span><span class="p">,</span> <span class="s1">&#39;method&#39;</span><span class="p">,</span> <span class="s1">&#39;get_value&#39;</span><span class="p">,</span> <span class="s1">&#39;static_method&#39;</span><span class="p">]</span> <span class="ow">or</span>
                            <span class="p">(</span><span class="ow">not</span> <span class="n">method_name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;__&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">method_name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">))</span>
                        <span class="p">)</span>

                        <span class="k">if</span> <span class="n">should_test</span><span class="p">:</span>
                            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Testing method: </span><span class="si">{</span><span class="n">method_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                            <span class="c1"># Check if it&#39;s an instance method with __func__</span>
                            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">method</span><span class="p">,</span> <span class="s1">&#39;__func__&#39;</span><span class="p">):</span>
                                <span class="k">try</span><span class="p">:</span>
                                    <span class="n">method_source</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">getsource</span><span class="p">(</span><span class="n">method</span><span class="p">)</span>
                                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    ✓ inspect.getsource() success: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">method_source</span><span class="p">)</span><span class="si">}</span><span class="s2"> chars&quot;</span><span class="p">)</span>
                                    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">method</span><span class="o">.</span><span class="vm">__func__</span><span class="p">,</span> <span class="s1">&#39;__code__&#39;</span><span class="p">):</span>
                                        <span class="n">code</span> <span class="o">=</span> <span class="n">method</span><span class="o">.</span><span class="vm">__func__</span><span class="o">.</span><span class="vm">__code__</span>
                                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    ✓ Filename: </span><span class="si">{</span><span class="n">code</span><span class="o">.</span><span class="n">co_filename</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    ✓ First line: </span><span class="si">{</span><span class="n">code</span><span class="o">.</span><span class="n">co_firstlineno</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                                <span class="k">except</span> <span class="p">(</span><span class="ne">OSError</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    ✗ inspect.getsource() failed: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                            <span class="c1"># Check if it&#39;s a static method or other callable</span>
                            <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">method</span><span class="p">,</span> <span class="s1">&#39;__code__&#39;</span><span class="p">):</span>
                                <span class="k">try</span><span class="p">:</span>
                                    <span class="n">method_source</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">getsource</span><span class="p">(</span><span class="n">method</span><span class="p">)</span>
                                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    ✓ inspect.getsource() success: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">method_source</span><span class="p">)</span><span class="si">}</span><span class="s2"> chars&quot;</span><span class="p">)</span>
                                    <span class="n">code</span> <span class="o">=</span> <span class="n">method</span><span class="o">.</span><span class="vm">__code__</span>
                                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    ✓ Filename: </span><span class="si">{</span><span class="n">code</span><span class="o">.</span><span class="n">co_filename</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    ✓ First line: </span><span class="si">{</span><span class="n">code</span><span class="o">.</span><span class="n">co_firstlineno</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                                <span class="k">except</span> <span class="p">(</span><span class="ne">OSError</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    ✗ inspect.getsource() failed: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    • Skipped built-in method or attribute&quot;</span><span class="p">)</span>

                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   Total methods tested: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="nb">dir</span><span class="p">(</span><span class="n">obj</span><span class="p">))</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

                <span class="c1"># Try inspect.getsource on class (may fail for dynamic classes)</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">inspect_class_source</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">getsource</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;✓ Class inspect.getsource() success: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">inspect_class_source</span><span class="p">)</span><span class="si">}</span><span class="s2"> chars&quot;</span><span class="p">)</span>
                <span class="k">except</span> <span class="p">(</span><span class="ne">OSError</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;✗ Class inspect.getsource() failed: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2"> (expected)&quot;</span><span class="p">)</span>

            <span class="k">elif</span> <span class="nb">callable</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">iscoroutinefunction</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Type: async function&quot;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Type: nested function&quot;</span><span class="p">)</span>

                <span class="c1"># Test function source</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="nb">hasattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="s1">&#39;__source__&#39;</span><span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">obj_name</span><span class="si">}</span><span class="s2"> missing __source__ attribute&quot;</span><span class="p">)</span>
                <span class="n">func_source</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">__source__</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;✓ Function source length: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">func_source</span><span class="p">)</span><span class="si">}</span><span class="s2"> chars&quot;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;✓ Virtual module: </span><span class="si">{</span><span class="nb">getattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;__module__&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;N/A&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

                <span class="c1"># Verify function definition exists in source</span>
                <span class="k">if</span> <span class="n">obj_name</span> <span class="o">==</span> <span class="s1">&#39;nested_function&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s1">&#39;def nested_function():&#39;</span><span class="p">,</span> <span class="n">func_source</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s1">&#39;def inner_function():&#39;</span><span class="p">,</span> <span class="n">func_source</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;✓ Contains nested function definition&quot;</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">obj_name</span> <span class="o">==</span> <span class="s1">&#39;async_function&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s1">&#39;async def async_function():&#39;</span><span class="p">,</span> <span class="n">func_source</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;✓ Contains async function definition&quot;</span><span class="p">)</span>

                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="s1">&#39;__code__&#39;</span><span class="p">):</span>
                    <span class="n">code</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="vm">__code__</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;✓ Code object filename: </span><span class="si">{</span><span class="n">code</span><span class="o">.</span><span class="n">co_filename</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;✓ Code object first line: </span><span class="si">{</span><span class="n">code</span><span class="o">.</span><span class="n">co_firstlineno</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;✓ Function name: </span><span class="si">{</span><span class="n">code</span><span class="o">.</span><span class="n">co_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

                <span class="c1"># Test inspect.getsource for functions (should work)</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">inspect_func_source</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">getsource</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;✓ inspect.getsource() success: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">inspect_func_source</span><span class="p">)</span><span class="si">}</span><span class="s2"> chars&quot;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">obj_name</span> <span class="o">==</span> <span class="s1">&#39;nested_function&#39;</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s1">&#39;def nested_function():&#39;</span><span class="p">,</span> <span class="n">inspect_func_source</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="n">obj_name</span> <span class="o">==</span> <span class="s1">&#39;async_function&#39;</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s1">&#39;async def async_function():&#39;</span><span class="p">,</span> <span class="n">inspect_func_source</span><span class="p">)</span>
                <span class="k">except</span> <span class="p">(</span><span class="ne">OSError</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;✗ inspect.getsource() failed: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="c1"># For complex nested functions, inspect.getsource might fail</span>
                    <span class="k">if</span> <span class="n">obj_name</span> <span class="o">!=</span> <span class="s1">&#39;nested_function&#39;</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">fail</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Function </span><span class="si">{</span><span class="n">obj_name</span><span class="si">}</span><span class="s2"> inspect.getsource() should work&quot;</span><span class="p">)</span>

        <span class="c1"># Additional test: verify inner function from nested_function</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">--- Testing nested inner function ---&quot;</span><span class="p">)</span>
        <span class="n">inner_func</span> <span class="o">=</span> <span class="n">nested_func</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">callable</span><span class="p">(</span><span class="n">inner_func</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Type: nested inner function&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Function name: </span><span class="si">{</span><span class="n">inner_func</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">inner_func</span><span class="p">,</span> <span class="s1">&#39;__code__&#39;</span><span class="p">):</span>
                <span class="n">code</span> <span class="o">=</span> <span class="n">inner_func</span><span class="o">.</span><span class="vm">__code__</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;✓ Inner function filename: </span><span class="si">{</span><span class="n">code</span><span class="o">.</span><span class="n">co_filename</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;✓ Inner function first line: </span><span class="si">{</span><span class="n">code</span><span class="o">.</span><span class="n">co_firstlineno</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="n">inner_source</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">getsource</span><span class="p">(</span><span class="n">inner_func</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;✓ Inner function inspect.getsource() success: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">inner_source</span><span class="p">)</span><span class="si">}</span><span class="s2"> chars&quot;</span><span class="p">)</span>
            <span class="k">except</span> <span class="p">(</span><span class="ne">OSError</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;✗ Inner function inspect.getsource() failed: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2"> (possible)&quot;</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">=== Detailed source code info test complete ===</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</details><details class="summary-output" open>
<summary>OUTPUT</summary><div class="highlight-default notranslate"><div class="highlight"><pre><span></span>=== Detailed source code info test ===

--- Testing nested_function ---
Type: nested function
✓ Function source length: 97 chars
✓ Virtual module: &lt;load_main:tmp0z4sqb64.py&gt;
✓ Contains nested function definition
✓ Code object filename: &lt;load_main:tmp0z4sqb64.py&gt;
✓ Code object first line: 7
✓ Function name: nested_function
✓ inspect.getsource() success: 114 chars

--- Testing async_function ---
Type: async function
✓ Function source length: 46 chars
✓ Virtual module: &lt;load_main:tmp0z4sqb64.py&gt;
✓ Contains async function definition
✓ Code object filename: &lt;load_main:tmp0z4sqb64.py&gt;
✓ Code object first line: 12
✓ Function name: async_function
✓ inspect.getsource() success: 55 chars

--- Testing ComplexClass ---
Type: complex class
✓ Class source length: 191 chars
✓ Virtual file: &lt;load_main:tmp0z4sqb64.py&gt;
✓ File attribute: &lt;load_main:tmp0z4sqb64.py&gt;
  Testing method: __init__
    ✓ inspect.getsource() success: 63 chars
    ✓ Filename: &lt;load_main:tmp0z4sqb64.py&gt;
    ✓ First line: 16
  Testing method: method
    ✓ inspect.getsource() success: 56 chars
    ✓ Filename: &lt;load_main:tmp0z4sqb64.py&gt;
    ✓ First line: 19
  Testing method: static_method
    ✓ inspect.getsource() success: 57 chars
    ✓ Filename: &lt;load_main:tmp0z4sqb64.py&gt;
    ✓ First line: 23
   Total methods tested: 31
✗ Class inspect.getsource() failed: &lt;class &#39;&lt;load_main:tmp0z4sqb64.py&gt;.ComplexClass&#39;&gt; is a built-in class (expected)

--- Testing nested inner function ---
Type: nested inner function
Function name: inner_function
✓ Inner function filename: &lt;string&gt;
✓ Inner function first line: 2
✗ Inner function inspect.getsource() failed: could not get source code (possible)

=== Detailed source code info test complete ===
</pre></div>
</div>
</details></section>
<section id="load-main-add-code-object-disabled">
<span id="unittests-unittest2doc-utils-exec-tool-load-main-add-code-object-disabled"></span><h2>load_main_add_code_object_disabled<a class="headerlink" href="#load-main-add-code-object-disabled" title="Link to this heading">¶</a></h2>
<p>Test that add_code_object=False doesn’t break anything.</p>
<details class="summary-input">
<summary>INPUT</summary><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">test_load_main_add_code_object_disabled</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test that add_code_object=False doesn&#39;t break anything.&quot;&quot;&quot;</span>
    <span class="n">test_content</span> <span class="o">=</span> <span class="n">dedent</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">        def helper():</span>
<span class="s1">            return &quot;helper&quot;</span>

<span class="s1">        if __name__ == &quot;__main__&quot;:</span>
<span class="s1">            def main_func():</span>
<span class="s1">                return &quot;main&quot;</span>

<span class="s1">            result = main_func()</span>
<span class="s1">    &#39;&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

    <span class="k">with</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">NamedTemporaryFile</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">suffix</span><span class="o">=</span><span class="s1">&#39;.py&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">test_content</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>

        <span class="n">module</span> <span class="o">=</span> <span class="n">load_module</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">test_globals</span> <span class="o">=</span> <span class="n">collect_module_attr</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="nb">all</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Test with add_code_object=False (default)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">load_main</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">add_code_object</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="nb">globals</span><span class="o">=</span><span class="n">test_globals</span><span class="p">)</span>

        <span class="c1"># Verify function works normally</span>
        <span class="n">main_func</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s1">&#39;main_func&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">main_func</span><span class="p">(),</span> <span class="s2">&quot;main&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;result&#39;</span><span class="p">],</span> <span class="s2">&quot;main&quot;</span><span class="p">)</span>

        <span class="c1"># inspect.getsource should fail as expected for dynamically created functions</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">((</span><span class="ne">OSError</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">)):</span>
            <span class="n">inspect</span><span class="o">.</span><span class="n">getsource</span><span class="p">(</span><span class="n">main_func</span><span class="p">)</span>
</pre></div>
</div>
</details></section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper"><div class="sphinx-toc sphinxlocaltoc">
    <h3><a href="../../../index.html">Page contents</a></h3>
    <ul>
<li><a class="reference internal" href="#">unittest2doc.utils.exec_tool</a><ul>
<li><a class="reference internal" href="#test-case-by-load-main">Test case by load_main</a></li>
<li><a class="reference internal" href="#filter-after-comment-string-match">filter_after_comment_string_match</a></li>
<li><a class="reference internal" href="#filter-after-comment-regex-match">filter_after_comment_regex_match</a></li>
<li><a class="reference internal" href="#filter-after-comment-no-match">filter_after_comment_no_match</a></li>
<li><a class="reference internal" href="#filter-after-comment-multiple-matches">filter_after_comment_multiple_matches</a></li>
<li><a class="reference internal" href="#filter-after-comment-empty-code">filter_after_comment_empty_code</a></li>
<li><a class="reference internal" href="#filter-after-comment-comment-at-end">filter_after_comment_comment_at_end</a></li>
<li><a class="reference internal" href="#filter-after-comment-regex-complex">filter_after_comment_regex_complex</a></li>
<li><a class="reference internal" href="#filter-after-comment-invalid-pattern-type">filter_after_comment_invalid_pattern_type</a></li>
<li><a class="reference internal" href="#load-module-with-module-name">load_module_with_module_name</a></li>
<li><a class="reference internal" href="#load-module-with-file-path">load_module_with_file_path</a></li>
<li><a class="reference internal" href="#load-module-with-module-object">load_module_with_module_object</a></li>
<li><a class="reference internal" href="#load-module-errors">load_module_errors</a></li>
<li><a class="reference internal" href="#collect-module-attr-all">collect_module_attr_all</a></li>
<li><a class="reference internal" href="#collect-module-attr-names-dict">collect_module_attr_names_dict</a></li>
<li><a class="reference internal" href="#collect-module-attr-names-list">collect_module_attr_names_list</a></li>
<li><a class="reference internal" href="#collect-module-attr-names-regex-dict">collect_module_attr_names_regex_dict</a></li>
<li><a class="reference internal" href="#collect-module-attr-names-regex-list">collect_module_attr_names_regex_list</a></li>
<li><a class="reference internal" href="#collect-module-attr-names-mapping-dict">collect_module_attr_names_mapping_dict</a></li>
<li><a class="reference internal" href="#collect-module-attr-names-mapping-callable">collect_module_attr_names_mapping_callable</a></li>
<li><a class="reference internal" href="#collect-module-attr-by-classes">collect_module_attr_by_classes</a></li>
<li><a class="reference internal" href="#collect-module-attr-all-classes">collect_module_attr_all_classes</a></li>
<li><a class="reference internal" href="#collect-module-attr-functions">collect_module_attr_functions</a></li>
<li><a class="reference internal" href="#collect-module-attr-combined">collect_module_attr_combined</a></li>
<li><a class="reference internal" href="#collect-module-attr-errors">collect_module_attr_errors</a></li>
<li><a class="reference internal" href="#load-main-basic">load_main_basic</a></li>
<li><a class="reference internal" href="#load-main-with-import">load_main_with_import</a></li>
<li><a class="reference internal" href="#load-main-with-classes">load_main_with_classes</a></li>
<li><a class="reference internal" href="#load-main-with-selective-collection">load_main_with_selective_collection</a></li>
<li><a class="reference internal" href="#load-main-with-custom-locals">load_main_with_custom_locals</a></li>
<li><a class="reference internal" href="#load-main-with-code-filter">load_main_with_code_filter</a></li>
<li><a class="reference internal" href="#load-main-with-name-mapping">load_main_with_name_mapping</a></li>
<li><a class="reference internal" href="#load-main-complex-main-block">load_main_complex_main_block</a></li>
<li><a class="reference internal" href="#load-main-with-module-object">load_main_with_module_object</a></li>
<li><a class="reference internal" href="#load-main-integration-complex">load_main_integration_complex</a></li>
<li><a class="reference internal" href="#load-main-error-cases">load_main_error_cases</a></li>
<li><a class="reference internal" href="#load-main-with-add-code-object">load_main_with_add_code_object</a></li>
<li><a class="reference internal" href="#load-main-add-code-object-complex">load_main_add_code_object_complex</a></li>
<li><a class="reference internal" href="#load-main-add-code-object-disabled">load_main_add_code_object_disabled</a></li>
</ul>
</li>
</ul>

  </div>
<div class="sphinx-toc sphinxglobaltoc">
<h3><a href="../../../index.html">Table of Contents</a></h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../catalogue.html">API Documentation</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../../catalogue.html#unittests">Unittests</a></li>
</ul>
</div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../../../_sources/unittests/unittest2doc/utils/exec_tool.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<search id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
    
    
        <div class="sidebar-toggle-group no-js">
            
            <button class="sidebar-toggle" id="sidebar-hide" title="Hide the sidebar menu">
                 «
                <span class="show-for-small">hide menu</span>
                
            </button>
            <button class="sidebar-toggle" id="sidebar-show" title="Show the sidebar menu">
                
                <span class="show-for-small">menu</span>
                <span class="hide-for-small">sidebar</span>
                 »
            </button>
        </div>
    
      <div class="clearer"></div>
    </div>
    <div class="relbar-bottom">
        
    <div class="related" role="navigation" aria-label="Related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> &nbsp; &nbsp;</li>
        <li class="right" >
          <a href="index.html" title="unittest2doc.utils"
             >previous</a> &nbsp; &nbsp;</li>
    <li><a href="../../../index.html">unittest2doc  documentation</a> &#187;</li>

          <li class="nav-item nav-item-1"><a href="../../../catalogue.html" >API Documentation</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="../../index.html" >UNITTESTs</a> &#187;</li>
          <li class="nav-item nav-item-3"><a href="../index.html" >unittest2doc</a> &#187;</li>
          <li class="nav-item nav-item-4"><a href="index.html" >unittest2doc.utils</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">unittest2doc.utils.exec_tool</a></li> 
      </ul>
    </div>
    </div>

    <div class="footer" role="contentinfo">
    &#169; Copyright 2025, Fmajor.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 8.1.3.
    </div>
    <!-- cloud_sptheme 1.4 -->
  </body>
</html>